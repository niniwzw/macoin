<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Bitcoin: src/walletdb.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bitcoin_logo_doxygen.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bitcoin
   &#160;<span id="projectnumber">0.5.0</span>
   </div>
   <div id="projectbrief">P2P Digital Currency</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_a5a49bdec207fb1b0616d2e91de4c093.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">walletdb.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="walletdb_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright (c) 2009-2010 Satoshi Nakamoto</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Copyright (c) 2009-2012 The Bitcoin developers</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Distributed under the MIT/X11 software license, see the accompanying</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// file COPYING or http://www.opensource.org/licenses/mit-license.php.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="walletdb_8h.html">walletdb.h</a>&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="wallet_8h.html">wallet.h</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;boost/version.hpp&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;boost/filesystem.hpp&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespaceboost.html">boost</a>;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">static</span> <a class="code" href="stdint_8h.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> nAccountingEntryNumber = 0;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="walletdb_8cpp.html#a0bc784e958b92854437f2238d4249da0">fWalletUnlockStakingOnly</a>;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// CWalletDB</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#ad1b3bce77e9dd6ddd8c668a469c38f0a">   22</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_wallet_d_b.html#ad1b3bce77e9dd6ddd8c668a469c38f0a">CWalletDB::WriteName</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; strAddress, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; strName)</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;{</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <a class="code" href="db_8cpp.html#aad0b4d8ce794391063e82239d0a20b09">nWalletDBUpdated</a>++;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">return</span> Write(make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;name&quot;</span>), strAddress), strName);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#a319209fcf90ea860b668b92c44a3fa7a">   28</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_wallet_d_b.html#a319209fcf90ea860b668b92c44a3fa7a">CWalletDB::EraseName</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; strAddress)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">// This should only be used for sending addresses, never for receiving addresses,</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// receiving addresses must always have an address book entry if they&#39;re not change return.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="db_8cpp.html#aad0b4d8ce794391063e82239d0a20b09">nWalletDBUpdated</a>++;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordflow">return</span> Erase(make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;name&quot;</span>), strAddress));</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#afa8d9d374072629b360adb49b9bdd584">   36</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_wallet_d_b.html#afa8d9d374072629b360adb49b9bdd584">CWalletDB::ReadAccount</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; strAccount, <a class="code" href="class_c_account.html">CAccount</a>&amp; account)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    account.<a class="code" href="class_c_account.html#ac63a4127fd899a21a5916a86588e809a">SetNull</a>();</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">return</span> Read(make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;acc&quot;</span>), strAccount), account);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;}</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#afef640a4990f74fd5af7178c99415cf3">   42</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_wallet_d_b.html#afef640a4990f74fd5af7178c99415cf3">CWalletDB::WriteAccount</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; strAccount, <span class="keyword">const</span> <a class="code" href="class_c_account.html">CAccount</a>&amp; account)</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">return</span> Write(make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;acc&quot;</span>), strAccount), account);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;}</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#ad96920c48370b68b08f9530516edecf2">   47</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_wallet_d_b.html#ad96920c48370b68b08f9530516edecf2">CWalletDB::WriteAccountingEntry</a>(<span class="keyword">const</span> <a class="code" href="stdint_8h.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> nAccEntryNum, <span class="keyword">const</span> <a class="code" href="class_c_accounting_entry.html">CAccountingEntry</a>&amp; acentry)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;{</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">return</span> Write(boost::make_tuple(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;acentry&quot;</span>), acentry.<a class="code" href="class_c_accounting_entry.html#a01434c1b0edad576bc1584c9b667ce1d">strAccount</a>, nAccEntryNum), acentry);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#a958a0138b171e213be35f48933adcb89">   52</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_wallet_d_b.html#ad96920c48370b68b08f9530516edecf2">CWalletDB::WriteAccountingEntry</a>(<span class="keyword">const</span> <a class="code" href="class_c_accounting_entry.html">CAccountingEntry</a>&amp; acentry)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;{</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">return</span> WriteAccountingEntry(++nAccountingEntryNumber, acentry);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#a7b853e605ddba528896e60c766b59075">   57</a></span>&#160;<a class="code" href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> <a class="code" href="class_c_wallet_d_b.html#a7b853e605ddba528896e60c766b59075">CWalletDB::GetAccountCreditDebit</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; strAccount)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;{</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    list&lt;CAccountingEntry&gt; entries;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    ListAccountCreditDebit(strAccount, entries);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> nCreditDebit = 0;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    BOOST_FOREACH (<span class="keyword">const</span> <a class="code" href="class_c_accounting_entry.html">CAccountingEntry</a>&amp; entry, entries)</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        nCreditDebit += entry.<a class="code" href="class_c_accounting_entry.html#abb080aaba00c27e0414904fb956aad2b">nCreditDebit</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">return</span> nCreditDebit;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#a51555c82291fe16081880110541e207f">   69</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_wallet_d_b.html#a51555c82291fe16081880110541e207f">CWalletDB::ListAccountCreditDebit</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; strAccount, list&lt;CAccountingEntry&gt;&amp; entries)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;{</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordtype">bool</span> fAllAccounts = (strAccount == <span class="stringliteral">&quot;*&quot;</span>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    Dbc* pcursor = GetCursor();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> (!pcursor)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;CWalletDB::ListAccountCreditDebit() : cannot create DB cursor&quot;</span>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fFlags = DB_SET_RANGE;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="comment">// Read next record</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <a class="code" href="class_c_data_stream.html">CDataStream</a> ssKey(<a class="code" href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a>, CLIENT_VERSION);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">if</span> (fFlags == DB_SET_RANGE)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            ssKey &lt;&lt; boost::make_tuple(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;acentry&quot;</span>), (fAllAccounts? <span class="keywordtype">string</span>(<span class="stringliteral">&quot;&quot;</span>) : strAccount), <a class="code" href="stdint_8h.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>(0));</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <a class="code" href="class_c_data_stream.html">CDataStream</a> ssValue(<a class="code" href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a>, CLIENT_VERSION);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordtype">int</span> ret = ReadAtCursor(pcursor, ssKey, ssValue, fFlags);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        fFlags = DB_NEXT;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">if</span> (ret == DB_NOTFOUND)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            pcursor-&gt;close();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;CWalletDB::ListAccountCreditDebit() : error scanning DB&quot;</span>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="comment">// Unserialize</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordtype">string</span> strType;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        ssKey &gt;&gt; strType;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordflow">if</span> (strType != <span class="stringliteral">&quot;acentry&quot;</span>)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <a class="code" href="class_c_accounting_entry.html">CAccountingEntry</a> acentry;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        ssKey &gt;&gt; acentry.<a class="code" href="class_c_accounting_entry.html#a01434c1b0edad576bc1584c9b667ce1d">strAccount</a>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordflow">if</span> (!fAllAccounts &amp;&amp; acentry.<a class="code" href="class_c_accounting_entry.html#a01434c1b0edad576bc1584c9b667ce1d">strAccount</a> != strAccount)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        ssValue &gt;&gt; acentry;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        ssKey &gt;&gt; acentry.nEntryNo;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        entries.push_back(acentry);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    pcursor-&gt;close();</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944">DBErrors</a></div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#afc27d9c9eef8b31851e6b02dc3191425">  114</a></span>&#160;<a class="code" href="class_c_wallet_d_b.html#afc27d9c9eef8b31851e6b02dc3191425">CWalletDB::ReorderTransactions</a>(<a class="code" href="class_c_wallet.html">CWallet</a>* pwallet)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;{</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pwallet-&gt;<a class="code" href="class_c_wallet.html#a4e6eb889f7638ed9695fdc0731581428">cs_wallet</a>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// Old wallets didn&#39;t have any defined order for transactions</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// Probably a bad idea to change the output of this</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// First: get all CWalletTx and CAccountingEntry into a sorted-by-time multimap.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keyword">typedef</span> pair&lt;CWalletTx*, CAccountingEntry*&gt; TxPair;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keyword">typedef</span> multimap&lt;int64_t, TxPair &gt; TxItems;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    TxItems txByTime;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">for</span> (map&lt;uint256, CWalletTx&gt;::iterator it = pwallet-&gt;<a class="code" href="class_c_wallet.html#a0b17f72f2170090f2de43a6c48af3214">mapWallet</a>.begin(); it != pwallet-&gt;<a class="code" href="class_c_wallet.html#a0b17f72f2170090f2de43a6c48af3214">mapWallet</a>.end(); ++it)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <a class="code" href="class_c_wallet_tx.html">CWalletTx</a>* wtx = &amp;((*it).second);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        txByTime.insert(make_pair(wtx-&gt;<a class="code" href="class_c_wallet_tx.html#af4f4b58875061467026da7b259532b69">nTimeReceived</a>, TxPair(wtx, (<a class="code" href="class_c_accounting_entry.html">CAccountingEntry</a>*)0)));</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    list&lt;CAccountingEntry&gt; acentries;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    ListAccountCreditDebit(<span class="stringliteral">&quot;&quot;</span>, acentries);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    BOOST_FOREACH(<a class="code" href="class_c_accounting_entry.html">CAccountingEntry</a>&amp; entry, acentries)</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        txByTime.insert(make_pair(entry.<a class="code" href="class_c_accounting_entry.html#a416a4eb8d47e4c4cfdfc366d9d777ae6">nTime</a>, TxPair((<a class="code" href="class_c_wallet_tx.html">CWalletTx</a>*)0, &amp;entry)));</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a>&amp; nOrderPosNext = pwallet-&gt;<a class="code" href="class_c_wallet.html#af56cb17b19742506fc8d9449fc60884e">nOrderPosNext</a>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    nOrderPosNext = 0;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    std::vector&lt;int64_t&gt; nOrderPosOffsets;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">for</span> (TxItems::iterator it = txByTime.begin(); it != txByTime.end(); ++it)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <a class="code" href="class_c_wallet_tx.html">CWalletTx</a> *<span class="keyword">const</span> pwtx = (*it).second.first;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="class_c_accounting_entry.html">CAccountingEntry</a> *<span class="keyword">const</span> pacentry = (*it).second.second;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <a class="code" href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a>&amp; nOrderPos = (pwtx != 0) ? pwtx-&gt;<a class="code" href="class_c_wallet_tx.html#af51e160ff1d9d78986e9f239c7ac7a35">nOrderPos</a> : pacentry-&gt;<a class="code" href="class_c_accounting_entry.html#a9c5f78f13a657c1f1fc860a70ef072d5">nOrderPos</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        if (nOrderPos == -1)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            nOrderPos = nOrderPosNext++;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            nOrderPosOffsets.push_back(nOrderPos);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="keywordflow">if</span> (pacentry)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <span class="comment">// Have to write accounting regardless, since we don&#39;t keep it in memory</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                <span class="keywordflow">if</span> (!WriteAccountingEntry(pacentry-&gt;<a class="code" href="class_c_accounting_entry.html#a0c35da8adbbc529238af70964e0d2b29">nEntryNo</a>, *pacentry))</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944ab5a338e1c914e0d9107fab0dbcd3c64c">DB_LOAD_FAIL</a>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            <a class="code" href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> nOrderPosOff = 0;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a>&amp; nOffsetStart, nOrderPosOffsets)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                <span class="keywordflow">if</span> (nOrderPos &gt;= nOffsetStart)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                    ++nOrderPosOff;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            nOrderPos += nOrderPosOff;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            nOrderPosNext = std::max(nOrderPosNext, nOrderPos + 1);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            <span class="keywordflow">if</span> (!nOrderPosOff)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="comment">// Since we&#39;re changing the order, write it back</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keywordflow">if</span> (pwtx)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                <span class="keywordflow">if</span> (!WriteTx(pwtx-&gt;<a class="code" href="class_c_transaction.html#a3f8666d2a275c40da14bd5eaf47dc004">GetHash</a>(), *pwtx))</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944ab5a338e1c914e0d9107fab0dbcd3c64c">DB_LOAD_FAIL</a>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                <span class="keywordflow">if</span> (!WriteAccountingEntry(pacentry-&gt;<a class="code" href="class_c_accounting_entry.html#a0c35da8adbbc529238af70964e0d2b29">nEntryNo</a>, *pacentry))</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944ab5a338e1c914e0d9107fab0dbcd3c64c">DB_LOAD_FAIL</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944aa2367ec374804930406cea446fbb3fd2">DB_LOAD_OK</a>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="class_c_wallet_scan_state.html">  185</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_c_wallet_scan_state.html">CWalletScanState</a> {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="class_c_wallet_scan_state.html#a8a6e0071320cbfffc6d7d49ded5d506e">  187</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_c_wallet_scan_state.html#a8a6e0071320cbfffc6d7d49ded5d506e">nKeys</a>;</div>
<div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="class_c_wallet_scan_state.html#ae1316ee4cfdf8fbff91ca32a5d0f2b6a">  188</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_c_wallet_scan_state.html#ae1316ee4cfdf8fbff91ca32a5d0f2b6a">nCKeys</a>;</div>
<div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="class_c_wallet_scan_state.html#a2cfbc8894839188b57be22e72f2d6de4">  189</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_c_wallet_scan_state.html#a2cfbc8894839188b57be22e72f2d6de4">nKeyMeta</a>;</div>
<div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="class_c_wallet_scan_state.html#a13c5139c5966079d1be4c739666c5243">  190</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_c_wallet_scan_state.html#a13c5139c5966079d1be4c739666c5243">fIsEncrypted</a>;</div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="class_c_wallet_scan_state.html#acafa7b6a27ec1a4714e9a7b331067e9d">  191</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_c_wallet_scan_state.html#acafa7b6a27ec1a4714e9a7b331067e9d">fAnyUnordered</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="class_c_wallet_scan_state.html#ad68ce61566ee2baf3d7b04b1390942d1">  192</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="class_c_wallet_scan_state.html#ad68ce61566ee2baf3d7b04b1390942d1">nFileVersion</a>;</div>
<div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="class_c_wallet_scan_state.html#a6cbf626ca5a0275f0469684f22dff12f">  193</a></span>&#160;    vector&lt;uint256&gt; <a class="code" href="class_c_wallet_scan_state.html#a6cbf626ca5a0275f0469684f22dff12f">vWalletUpgrade</a>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="class_c_wallet_scan_state.html#a8012f2b0c336f7ee0b842d875f4fa4e6">  195</a></span>&#160;    <a class="code" href="class_c_wallet_scan_state.html#a8012f2b0c336f7ee0b842d875f4fa4e6">CWalletScanState</a>() {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        nKeys = nCKeys = nKeyMeta = 0;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        fIsEncrypted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        fAnyUnordered = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        nFileVersion = 0;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;};</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00204"></a><span class="lineno"><a class="line" href="walletdb_8cpp.html#ad1f171cf096f5479805a06fc20480343">  204</a></span>&#160;<a class="code" href="walletdb_8cpp.html#ad1f171cf096f5479805a06fc20480343">ReadKeyValue</a>(<a class="code" href="class_c_wallet.html">CWallet</a>* pwallet, <a class="code" href="class_c_data_stream.html">CDataStream</a>&amp; ssKey, <a class="code" href="class_c_data_stream.html">CDataStream</a>&amp; ssValue,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;             <a class="code" href="class_c_wallet_scan_state.html">CWalletScanState</a> &amp;wss, <span class="keywordtype">string</span>&amp; strType, <span class="keywordtype">string</span>&amp; strErr)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;{</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="comment">// Unserialize</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="comment">// Taking advantage of the fact that pair serialization</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">// is just the two items serialized one after the other</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        ssKey &gt;&gt; strType;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;name&quot;</span>)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="keywordtype">string</span> strAddress;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            ssKey &gt;&gt; strAddress;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            ssValue &gt;&gt; pwallet-&gt;<a class="code" href="class_c_wallet.html#afed31f2489c987e0f76233121ed84ab7">mapAddressBook</a>[<a class="code" href="class_c_bitcoin_address.html">CBitcoinAddress</a>(strAddress).<a class="code" href="class_c_bitcoin_address.html#a46d632250c4b47727f8e9b2f8141fd69">Get</a>()];</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;tx&quot;</span>)</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <a class="code" href="classuint256.html">uint256</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            ssKey &gt;&gt; <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <a class="code" href="class_c_wallet_tx.html">CWalletTx</a>&amp; wtx = pwallet-&gt;<a class="code" href="class_c_wallet.html#a0b17f72f2170090f2de43a6c48af3214">mapWallet</a>[<a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>];</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            ssValue &gt;&gt; wtx;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="keywordflow">if</span> (wtx.CheckTransaction() &amp;&amp; (wtx.GetHash() == <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>))</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                wtx.<a class="code" href="class_c_wallet_tx.html#ab0ee7347584bff886dc24b9f63ff023c">BindWallet</a>(pwallet);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                pwallet-&gt;<a class="code" href="class_c_wallet.html#a0b17f72f2170090f2de43a6c48af3214">mapWallet</a>.erase(hash);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="comment">// Undo serialize changes in 31600</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">if</span> (31404 &lt;= wtx.fTimeReceivedIsTxTime &amp;&amp; wtx.fTimeReceivedIsTxTime &lt;= 31703)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="keywordflow">if</span> (!ssValue.<a class="code" href="class_c_data_stream.html#a6e50e788d33080ac804e4d8ba7150279">empty</a>())</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                    <span class="keywordtype">char</span> fTmp;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    <span class="keywordtype">char</span> fUnused;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    ssValue &gt;&gt; fTmp &gt;&gt; fUnused &gt;&gt; wtx.strFromAccount;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    strErr = <a class="code" href="util_8h.html#a86c8651322c9dd7ba3abf64c088993be">strprintf</a>(<span class="stringliteral">&quot;LoadWallet() upgrading tx ver=%d %d &#39;%s&#39; %s&quot;</span>,</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                                       wtx.fTimeReceivedIsTxTime, fTmp, wtx.strFromAccount.c_str(), hash.ToString().c_str());</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    wtx.fTimeReceivedIsTxTime = fTmp;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                    strErr = <a class="code" href="util_8h.html#a86c8651322c9dd7ba3abf64c088993be">strprintf</a>(<span class="stringliteral">&quot;LoadWallet() repairing tx ver=%d %s&quot;</span>, wtx.fTimeReceivedIsTxTime, hash.ToString().c_str());</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    wtx.fTimeReceivedIsTxTime = 0;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                wss.<a class="code" href="class_c_wallet_scan_state.html#a6cbf626ca5a0275f0469684f22dff12f">vWalletUpgrade</a>.push_back(hash);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="keywordflow">if</span> (wtx.nOrderPos == -1)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                wss.<a class="code" href="class_c_wallet_scan_state.html#acafa7b6a27ec1a4714e9a7b331067e9d">fAnyUnordered</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="comment">//printf(&quot;LoadWallet  %s\n&quot;, wtx.GetHash().ToString().c_str());</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            <span class="comment">//printf(&quot; %12&quot;PRId64&quot;  %s  %s  %s\n&quot;,</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="comment">//    wtx.vout[0].nValue,</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="comment">//    DateTimeStrFormat(&quot;%x %H:%M:%S&quot;, wtx.GetBlockTime()).c_str(),</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="comment">//    wtx.hashBlock.ToString().substr(0,20).c_str(),</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="comment">//    wtx.mapValue[&quot;message&quot;].c_str());</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;acentry&quot;</span>)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="keywordtype">string</span> strAccount;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            ssKey &gt;&gt; strAccount;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <a class="code" href="stdint_8h.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> nNumber;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            ssKey &gt;&gt; nNumber;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <span class="keywordflow">if</span> (nNumber &gt; nAccountingEntryNumber)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                nAccountingEntryNumber = nNumber;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            <span class="keywordflow">if</span> (!wss.<a class="code" href="class_c_wallet_scan_state.html#acafa7b6a27ec1a4714e9a7b331067e9d">fAnyUnordered</a>)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                <a class="code" href="class_c_accounting_entry.html">CAccountingEntry</a> acentry;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                ssValue &gt;&gt; acentry;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                <span class="keywordflow">if</span> (acentry.nOrderPos == -1)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                    wss.<a class="code" href="class_c_wallet_scan_state.html#acafa7b6a27ec1a4714e9a7b331067e9d">fAnyUnordered</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;key&quot;</span> || strType == <span class="stringliteral">&quot;wkey&quot;</span>)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            vector&lt;unsigned char&gt; vchPubKey;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            ssKey &gt;&gt; vchPubKey;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <a class="code" href="class_c_key.html">CKey</a> key;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;key&quot;</span>)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                wss.<a class="code" href="class_c_wallet_scan_state.html#a8a6e0071320cbfffc6d7d49ded5d506e">nKeys</a>++;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <a class="code" href="key_8h.html#a1da569b8b6e5b3fa1196cc1b877e7f54">CPrivKey</a> pkey;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                ssValue &gt;&gt; pkey;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                key.<a class="code" href="class_c_key.html#a243517185c6bb7697640fe5d2639077f">SetPubKey</a>(vchPubKey);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                <span class="keywordflow">if</span> (!key.<a class="code" href="class_c_key.html#a4f5fd24b068dbbe49a0f9e28d69fef5d">SetPrivKey</a>(pkey))</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    strErr = <span class="stringliteral">&quot;Error reading wallet database: CPrivKey corrupt&quot;</span>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keywordflow">if</span> (key.<a class="code" href="class_c_key.html#ae4b61da6ec62f676fe6362ac5fc26aca">GetPubKey</a>() != vchPubKey)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                    strErr = <span class="stringliteral">&quot;Error reading wallet database: CPrivKey pubkey inconsistency&quot;</span>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                <span class="keywordflow">if</span> (!key.<a class="code" href="class_c_key.html#a1f368a65eb50efe5b4dff5a481795dec">IsValid</a>())</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    strErr = <span class="stringliteral">&quot;Error reading wallet database: invalid CPrivKey&quot;</span>;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                <a class="code" href="class_c_wallet_key.html">CWalletKey</a> wkey;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                ssValue &gt;&gt; wkey;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                key.<a class="code" href="class_c_key.html#a243517185c6bb7697640fe5d2639077f">SetPubKey</a>(vchPubKey);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                <span class="keywordflow">if</span> (!key.<a class="code" href="class_c_key.html#a4f5fd24b068dbbe49a0f9e28d69fef5d">SetPrivKey</a>(wkey.vchPrivKey))</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    strErr = <span class="stringliteral">&quot;Error reading wallet database: CPrivKey corrupt&quot;</span>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                <span class="keywordflow">if</span> (key.<a class="code" href="class_c_key.html#ae4b61da6ec62f676fe6362ac5fc26aca">GetPubKey</a>() != vchPubKey)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                    strErr = <span class="stringliteral">&quot;Error reading wallet database: CWalletKey pubkey inconsistency&quot;</span>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <span class="keywordflow">if</span> (!key.<a class="code" href="class_c_key.html#a1f368a65eb50efe5b4dff5a481795dec">IsValid</a>())</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                    strErr = <span class="stringliteral">&quot;Error reading wallet database: invalid CWalletKey&quot;</span>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordflow">if</span> (!pwallet-&gt;<a class="code" href="class_c_wallet.html#a94c9cdf069f0bb17c09aca0580271359">LoadKey</a>(key))</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                strErr = <span class="stringliteral">&quot;Error reading wallet database: LoadKey failed&quot;</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;mkey&quot;</span>)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nID;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            ssKey &gt;&gt; nID;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <a class="code" href="class_c_master_key.html">CMasterKey</a> kMasterKey;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            ssValue &gt;&gt; kMasterKey;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="keywordflow">if</span>(pwallet-&gt;<a class="code" href="class_c_wallet.html#a23c5badf56c297a95557af3073d4aa32">mapMasterKeys</a>.count(nID) != 0)</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                strErr = <a class="code" href="util_8h.html#a86c8651322c9dd7ba3abf64c088993be">strprintf</a>(<span class="stringliteral">&quot;Error reading wallet database: duplicate CMasterKey id %u&quot;</span>, nID);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            pwallet-&gt;<a class="code" href="class_c_wallet.html#a23c5badf56c297a95557af3073d4aa32">mapMasterKeys</a>[nID] = kMasterKey;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">if</span> (pwallet-&gt;<a class="code" href="class_c_wallet.html#aecfc6e4a6ea958ec369ca77d790271e3">nMasterKeyMaxID</a> &lt; nID)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                pwallet-&gt;<a class="code" href="class_c_wallet.html#aecfc6e4a6ea958ec369ca77d790271e3">nMasterKeyMaxID</a> = nID;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;ckey&quot;</span>)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            wss.<a class="code" href="class_c_wallet_scan_state.html#ae1316ee4cfdf8fbff91ca32a5d0f2b6a">nCKeys</a>++;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            vector&lt;unsigned char&gt; vchPubKey;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            ssKey &gt;&gt; vchPubKey;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            vector&lt;unsigned char&gt; vchPrivKey;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            ssValue &gt;&gt; vchPrivKey;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="keywordflow">if</span> (!pwallet-&gt;<a class="code" href="class_c_wallet.html#a01fbd78238d4ef833d059f12a7e8ac9f">LoadCryptedKey</a>(vchPubKey, vchPrivKey))</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                strErr = <span class="stringliteral">&quot;Error reading wallet database: LoadCryptedKey failed&quot;</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            wss.<a class="code" href="class_c_wallet_scan_state.html#a13c5139c5966079d1be4c739666c5243">fIsEncrypted</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;keymeta&quot;</span>)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <a class="code" href="class_c_pub_key.html">CPubKey</a> vchPubKey;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            ssKey &gt;&gt; vchPubKey;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <a class="code" href="class_c_key_metadata.html">CKeyMetadata</a> keyMeta;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            ssValue &gt;&gt; keyMeta;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            wss.<a class="code" href="class_c_wallet_scan_state.html#a2cfbc8894839188b57be22e72f2d6de4">nKeyMeta</a>++;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            pwallet-&gt;<a class="code" href="class_c_wallet.html#a21e6580474514f838dfe1446890085a4">LoadKeyMetadata</a>(vchPubKey, keyMeta);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="comment">// find earliest key creation time, as wallet birthday</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="keywordflow">if</span> (!pwallet-&gt;<a class="code" href="class_c_wallet.html#a817c0d1034377a7bd70a714140a5a8ca">nTimeFirstKey</a> ||</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                (keyMeta.nCreateTime &lt; pwallet-&gt;<a class="code" href="class_c_wallet.html#a817c0d1034377a7bd70a714140a5a8ca">nTimeFirstKey</a>))</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                pwallet-&gt;<a class="code" href="class_c_wallet.html#a817c0d1034377a7bd70a714140a5a8ca">nTimeFirstKey</a> = keyMeta.nCreateTime;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;defaultkey&quot;</span>)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            ssValue &gt;&gt; pwallet-&gt;<a class="code" href="class_c_wallet.html#a6d415899e530a91e6e28dd0fa4ecef8d">vchDefaultKey</a>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;pool&quot;</span>)</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <a class="code" href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> nIndex;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            ssKey &gt;&gt; nIndex;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <a class="code" href="class_c_key_pool.html">CKeyPool</a> keypool;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            ssValue &gt;&gt; keypool;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            pwallet-&gt;<a class="code" href="class_c_wallet.html#a363fabb2b82d596c33e4fa3920a11c26">setKeyPool</a>.insert(nIndex);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="comment">// If no metadata exists yet, create a default with the pool key&#39;s</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="comment">// creation time. Note that this may be overwritten by actually</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="comment">// stored metadata for that key later, which is fine.</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <a class="code" href="class_c_key_i_d.html">CKeyID</a> keyid = keypool.vchPubKey.GetID();</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordflow">if</span> (pwallet-&gt;<a class="code" href="class_c_wallet.html#acfd09bc5a2daee930f9f988efac8dbb7">mapKeyMetadata</a>.count(keyid) == 0)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                pwallet-&gt;<a class="code" href="class_c_wallet.html#acfd09bc5a2daee930f9f988efac8dbb7">mapKeyMetadata</a>[keyid] = <a class="code" href="class_c_key_metadata.html">CKeyMetadata</a>(keypool.nTime);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;version&quot;</span>)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            ssValue &gt;&gt; wss.<a class="code" href="class_c_wallet_scan_state.html#ad68ce61566ee2baf3d7b04b1390942d1">nFileVersion</a>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="keywordflow">if</span> (wss.<a class="code" href="class_c_wallet_scan_state.html#ad68ce61566ee2baf3d7b04b1390942d1">nFileVersion</a> == 10300)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                wss.<a class="code" href="class_c_wallet_scan_state.html#ad68ce61566ee2baf3d7b04b1390942d1">nFileVersion</a> = 300;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;cscript&quot;</span>)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <a class="code" href="classuint160.html">uint160</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            ssKey &gt;&gt; <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <a class="code" href="class_c_script.html">CScript</a> script;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            ssValue &gt;&gt; script;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <span class="keywordflow">if</span> (!pwallet-&gt;<a class="code" href="class_c_wallet.html#adbf0abef9da8102f000d4afd5cec5bbc">LoadCScript</a>(script))</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                strErr = <span class="stringliteral">&quot;Error reading wallet database: LoadCScript failed&quot;</span>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;orderposnext&quot;</span>)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            ssValue &gt;&gt; pwallet-&gt;<a class="code" href="class_c_wallet.html#af56cb17b19742506fc8d9449fc60884e">nOrderPosNext</a>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    } <span class="keywordflow">catch</span> (...)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;}</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> IsKeyType(<span class="keywordtype">string</span> strType)</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;{</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">return</span> (strType== <span class="stringliteral">&quot;key&quot;</span> || strType == <span class="stringliteral">&quot;wkey&quot;</span> ||</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            strType == <span class="stringliteral">&quot;mkey&quot;</span> || strType == <span class="stringliteral">&quot;ckey&quot;</span>);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;}</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#a14f26e53502d1a60dd2b034f830acf03">  433</a></span>&#160;<a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944">DBErrors</a> <a class="code" href="class_c_wallet_d_b.html#a14f26e53502d1a60dd2b034f830acf03">CWalletDB::LoadWallet</a>(<a class="code" href="class_c_wallet.html">CWallet</a>* pwallet)</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;{</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    pwallet-&gt;<a class="code" href="class_c_wallet.html#a6d415899e530a91e6e28dd0fa4ecef8d">vchDefaultKey</a> = <a class="code" href="class_c_pub_key.html">CPubKey</a>();</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <a class="code" href="class_c_wallet_scan_state.html">CWalletScanState</a> wss;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordtype">bool</span> fNoncriticalErrors = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944">DBErrors</a> result = <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944aa2367ec374804930406cea446fbb3fd2">DB_LOAD_OK</a>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pwallet-&gt;<a class="code" href="class_c_wallet.html#a4e6eb889f7638ed9695fdc0731581428">cs_wallet</a>);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordtype">int</span> nMinVersion = 0;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">if</span> (Read((<span class="keywordtype">string</span>)<span class="stringliteral">&quot;minversion&quot;</span>, nMinVersion))</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <span class="keywordflow">if</span> (nMinVersion &gt; CLIENT_VERSION)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944a0e0f7a1f3a38544a975bd97fba1eed58">DB_TOO_NEW</a>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            pwallet-&gt;<a class="code" href="class_c_wallet.html#a88317da8dab80135b8db73e945e15b60">LoadMinVersion</a>(nMinVersion);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="comment">// Get cursor</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        Dbc* pcursor = GetCursor();</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">if</span> (!pcursor)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Error getting wallet database cursor\n&quot;</span>);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944a5eb73e7d323c832e22611f0ff94b1655">DB_CORRUPT</a>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="comment">// Read next record</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <a class="code" href="class_c_data_stream.html">CDataStream</a> ssKey(<a class="code" href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a>, CLIENT_VERSION);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            <a class="code" href="class_c_data_stream.html">CDataStream</a> ssValue(<a class="code" href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a>, CLIENT_VERSION);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <span class="keywordtype">int</span> ret = ReadAtCursor(pcursor, ssKey, ssValue);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordflow">if</span> (ret == DB_NOTFOUND)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Error reading next record from wallet database\n&quot;</span>);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944a5eb73e7d323c832e22611f0ff94b1655">DB_CORRUPT</a>;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <span class="comment">// Try to be tolerant of single corrupt records:</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="keywordtype">string</span> strType, strErr;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="walletdb_8cpp.html#ad1f171cf096f5479805a06fc20480343">ReadKeyValue</a>(pwallet, ssKey, ssValue, wss, strType, strErr))</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            {</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                <span class="comment">// losing keys is considered a catastrophic error, anything else</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                <span class="comment">// we assume the user can live with:</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                <span class="keywordflow">if</span> (IsKeyType(strType))</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                    result = <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944a5eb73e7d323c832e22611f0ff94b1655">DB_CORRUPT</a>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                    <span class="comment">// Leave other errors alone, if we try to fix them we might make things worse.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                    fNoncriticalErrors = <span class="keyword">true</span>; <span class="comment">// ... but do warn the user there is something wrong.</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                    <span class="keywordflow">if</span> (strType == <span class="stringliteral">&quot;tx&quot;</span>)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                        <span class="comment">// Rescan if there is a bad transaction record:</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                        <a class="code" href="util_8cpp.html#acb3060cad083d342898b6055e43692ae">SoftSetBoolArg</a>(<span class="stringliteral">&quot;-rescan&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            <span class="keywordflow">if</span> (!strErr.empty())</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, strErr.c_str());</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        pcursor-&gt;close();</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">catch</span> (...)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        result = <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944a5eb73e7d323c832e22611f0ff94b1655">DB_CORRUPT</a>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">if</span> (fNoncriticalErrors &amp;&amp; result == <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944aa2367ec374804930406cea446fbb3fd2">DB_LOAD_OK</a>)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        result = <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944ac83155a59a0d2ca8fc325075f58060c5">DB_NONCRITICAL_ERROR</a>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">// Any wallet corruption at all: skip any rewriting or</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">// upgrading, we don&#39;t want to make it worse.</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944aa2367ec374804930406cea446fbb3fd2">DB_LOAD_OK</a>)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;nFileVersion = %d\n&quot;</span>, wss.<a class="code" href="class_c_wallet_scan_state.html#ad68ce61566ee2baf3d7b04b1390942d1">nFileVersion</a>);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Keys: %u plaintext, %u encrypted, %u w/ metadata, %u total\n&quot;</span>,</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;           wss.<a class="code" href="class_c_wallet_scan_state.html#a8a6e0071320cbfffc6d7d49ded5d506e">nKeys</a>, wss.<a class="code" href="class_c_wallet_scan_state.html#ae1316ee4cfdf8fbff91ca32a5d0f2b6a">nCKeys</a>, wss.<a class="code" href="class_c_wallet_scan_state.html#a2cfbc8894839188b57be22e72f2d6de4">nKeyMeta</a>, wss.<a class="code" href="class_c_wallet_scan_state.html#a8a6e0071320cbfffc6d7d49ded5d506e">nKeys</a> + wss.<a class="code" href="class_c_wallet_scan_state.html#ae1316ee4cfdf8fbff91ca32a5d0f2b6a">nCKeys</a>);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">// nTimeFirstKey is only reliable if all keys have metadata</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">if</span> ((wss.<a class="code" href="class_c_wallet_scan_state.html#a8a6e0071320cbfffc6d7d49ded5d506e">nKeys</a> + wss.<a class="code" href="class_c_wallet_scan_state.html#ae1316ee4cfdf8fbff91ca32a5d0f2b6a">nCKeys</a>) != wss.<a class="code" href="class_c_wallet_scan_state.html#a2cfbc8894839188b57be22e72f2d6de4">nKeyMeta</a>)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        pwallet-&gt;<a class="code" href="class_c_wallet.html#a817c0d1034377a7bd70a714140a5a8ca">nTimeFirstKey</a> = 1; <span class="comment">// 0 would be considered &#39;no value&#39;</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    BOOST_FOREACH(<a class="code" href="classuint256.html">uint256</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>, wss.<a class="code" href="class_c_wallet_scan_state.html#a6cbf626ca5a0275f0469684f22dff12f">vWalletUpgrade</a>)</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        WriteTx(hash, pwallet-&gt;<a class="code" href="class_c_wallet.html#a0b17f72f2170090f2de43a6c48af3214">mapWallet</a>[hash]);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// Rewrite encrypted wallets of versions 0.4.0 and 0.5.0rc:</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">if</span> (wss.<a class="code" href="class_c_wallet_scan_state.html#a13c5139c5966079d1be4c739666c5243">fIsEncrypted</a> &amp;&amp; (wss.<a class="code" href="class_c_wallet_scan_state.html#ad68ce61566ee2baf3d7b04b1390942d1">nFileVersion</a> == 40000 || wss.<a class="code" href="class_c_wallet_scan_state.html#ad68ce61566ee2baf3d7b04b1390942d1">nFileVersion</a> == 50000))</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944aef89bee2c244fcd980d6cf7edc5bf2d6">DB_NEED_REWRITE</a>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">if</span> (wss.<a class="code" href="class_c_wallet_scan_state.html#ad68ce61566ee2baf3d7b04b1390942d1">nFileVersion</a> &lt; CLIENT_VERSION) <span class="comment">// Update</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        WriteVersion(CLIENT_VERSION);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">if</span> (wss.<a class="code" href="class_c_wallet_scan_state.html#acafa7b6a27ec1a4714e9a7b331067e9d">fAnyUnordered</a>)</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        result = ReorderTransactions(pwallet);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;}</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno"><a class="line" href="walletdb_8cpp.html#a33aac5a93b3a2c27bd38315370aaf829">  533</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="walletdb_8cpp.html#a33aac5a93b3a2c27bd38315370aaf829">ThreadFlushWalletDB</a>(<span class="keywordtype">void</span>* parg)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;{</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">// Make this thread recognisable as the wallet flushing thread</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <a class="code" href="util_8cpp.html#a85fc1244e0bd3c91ee7a1c05ed10ebbb">RenameThread</a>(<span class="stringliteral">&quot;bityuan-wallet&quot;</span>);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; strFile = ((<span class="keyword">const</span> <span class="keywordtype">string</span>*)parg)[0];</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> fOneThread;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">if</span> (fOneThread)</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    fOneThread = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="util_8cpp.html#a64d956f1dda7f9a80ab5d594532b906d">GetBoolArg</a>(<span class="stringliteral">&quot;-flushwallet&quot;</span>, <span class="keyword">true</span>))</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nLastSeen = <a class="code" href="db_8cpp.html#aad0b4d8ce794391063e82239d0a20b09">nWalletDBUpdated</a>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nLastFlushed = <a class="code" href="db_8cpp.html#aad0b4d8ce794391063e82239d0a20b09">nWalletDBUpdated</a>;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <a class="code" href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> nLastWalletUpdate = <a class="code" href="util_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="util_8cpp.html#a5f70d0c660389bbdbd3fe69af14c9161">fShutdown</a>)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <a class="code" href="util_8h.html#ac635182d3e845eda4af4fa5ab31609da">MilliSleep</a>(500);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">if</span> (nLastSeen != <a class="code" href="db_8cpp.html#aad0b4d8ce794391063e82239d0a20b09">nWalletDBUpdated</a>)</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            nLastSeen = <a class="code" href="db_8cpp.html#aad0b4d8ce794391063e82239d0a20b09">nWalletDBUpdated</a>;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            nLastWalletUpdate = <a class="code" href="util_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordflow">if</span> (nLastFlushed != <a class="code" href="db_8cpp.html#aad0b4d8ce794391063e82239d0a20b09">nWalletDBUpdated</a> &amp;&amp; <a class="code" href="util_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>() - nLastWalletUpdate &gt;= 2)</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <a class="code" href="sync_8h.html#aca08e7299069c2d60b8aa726fc550612">TRY_LOCK</a>(<a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#af71bf28f9142c38aedc550353270b2b7">cs_db</a>,lockDb);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <span class="keywordflow">if</span> (lockDb)</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                <span class="comment">// Don&#39;t do this if any databases are in use</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                <span class="keywordtype">int</span> nRefCount = 0;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                map&lt;string, int&gt;::iterator mi = <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#a3b8a3caf48395ef3f05e3717b33bf32c">mapFileUseCount</a>.begin();</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="keywordflow">while</span> (mi != <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#a3b8a3caf48395ef3f05e3717b33bf32c">mapFileUseCount</a>.end())</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                    nRefCount += (*mi).second;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                    mi++;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                <span class="keywordflow">if</span> (nRefCount == 0 &amp;&amp; !<a class="code" href="util_8cpp.html#a5f70d0c660389bbdbd3fe69af14c9161">fShutdown</a>)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    map&lt;string, int&gt;::iterator mi = <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#a3b8a3caf48395ef3f05e3717b33bf32c">mapFileUseCount</a>.find(strFile);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    <span class="keywordflow">if</span> (mi != <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#a3b8a3caf48395ef3f05e3717b33bf32c">mapFileUseCount</a>.end())</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Flushing wallet.dat\n&quot;</span>);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                        nLastFlushed = <a class="code" href="db_8cpp.html#aad0b4d8ce794391063e82239d0a20b09">nWalletDBUpdated</a>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                        <a class="code" href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> nStart = <a class="code" href="util_8h.html#a139d0fe6387b9e230a9b8bb12d9b43b9">GetTimeMillis</a>();</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                        <span class="comment">// Flush wallet.dat so it&#39;s self contained</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                        <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#ac53fd53afdd1e0881b8ffbb11a89b556">CloseDb</a>(strFile);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                        <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#aaf4c0dd43825ee2441eaa4177bef137b">CheckpointLSN</a>(strFile);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                        <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#a3b8a3caf48395ef3f05e3717b33bf32c">mapFileUseCount</a>.erase(mi++);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Flushed wallet.dat %&quot;</span>PRId64<span class="stringliteral">&quot;ms\n&quot;</span>, <a class="code" href="util_8h.html#a139d0fe6387b9e230a9b8bb12d9b43b9">GetTimeMillis</a>() - nStart);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                    }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;}</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div>
<div class="line"><a name="l00595"></a><span class="lineno"><a class="line" href="walletdb_8cpp.html#a273c3692765c732c5f724cec93e6b62f">  595</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="walletdb_8cpp.html#a273c3692765c732c5f724cec93e6b62f">BackupWallet</a>(<span class="keyword">const</span> <a class="code" href="class_c_wallet.html">CWallet</a>&amp; wallet, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; strDest)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;{</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">if</span> (!wallet.<a class="code" href="class_c_wallet.html#a1b2e285b4d7bd105c792941aa666249c">fFileBacked</a>)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="util_8cpp.html#a5f70d0c660389bbdbd3fe69af14c9161">fShutdown</a>)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#af71bf28f9142c38aedc550353270b2b7">cs_db</a>);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#a3b8a3caf48395ef3f05e3717b33bf32c">mapFileUseCount</a>.count(wallet.<a class="code" href="class_c_wallet.html#a3e886f3a3b20228770e082b3fc014fc7">strWalletFile</a>) || <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#a3b8a3caf48395ef3f05e3717b33bf32c">mapFileUseCount</a>[wallet.<a class="code" href="class_c_wallet.html#a3e886f3a3b20228770e082b3fc014fc7">strWalletFile</a>] == 0)</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                <span class="comment">// Flush log data to the dat file</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#ac53fd53afdd1e0881b8ffbb11a89b556">CloseDb</a>(wallet.<a class="code" href="class_c_wallet.html#a3e886f3a3b20228770e082b3fc014fc7">strWalletFile</a>);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#aaf4c0dd43825ee2441eaa4177bef137b">CheckpointLSN</a>(wallet.<a class="code" href="class_c_wallet.html#a3e886f3a3b20228770e082b3fc014fc7">strWalletFile</a>);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                <a class="code" href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a>.<a class="code" href="class_c_d_b_env.html#a3b8a3caf48395ef3f05e3717b33bf32c">mapFileUseCount</a>.erase(wallet.<a class="code" href="class_c_wallet.html#a3e886f3a3b20228770e082b3fc014fc7">strWalletFile</a>);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                <span class="comment">// Copy wallet.dat</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                filesystem::path pathSrc = <a class="code" href="util_8cpp.html#ab83866a054745d4b30a3948a1b44beba">GetDataDir</a>() / wallet.<a class="code" href="class_c_wallet.html#a3e886f3a3b20228770e082b3fc014fc7">strWalletFile</a>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                filesystem::path pathDest(strDest);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                <span class="keywordflow">if</span> (filesystem::is_directory(pathDest))</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                    pathDest /= wallet.<a class="code" href="class_c_wallet.html#a3e886f3a3b20228770e082b3fc014fc7">strWalletFile</a>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="preprocessor">#if BOOST_VERSION &gt;= 104000</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                    filesystem::copy_file(pathSrc, pathDest, filesystem::copy_option::overwrite_if_exists);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                    filesystem::copy_file(pathSrc, pathDest);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;copied wallet.dat to %s\n&quot;</span>, pathDest.string().c_str());</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                } <span class="keywordflow">catch</span>(<span class="keyword">const</span> filesystem::filesystem_error &amp;e) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;error copying wallet.dat to %s - %s\n&quot;</span>, pathDest.string().c_str(), e.what());</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <a class="code" href="util_8h.html#ac635182d3e845eda4af4fa5ab31609da">MilliSleep</a>(100);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    }</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">// Try to (very carefully!) recover wallet.dat if there is a problem.</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00638"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#a3ebeb12f37d9c66512e2bc2903a6854a">  638</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_wallet_d_b.html#a3ebeb12f37d9c66512e2bc2903a6854a">CWalletDB::Recover</a>(<a class="code" href="class_c_d_b_env.html">CDBEnv</a>&amp; dbenv, std::string filename, <span class="keywordtype">bool</span> fOnlyKeys)</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;{</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">// Recovery procedure:</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">// move wallet.dat to wallet.timestamp.bak</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">// Call Salvage with fAggressive=true to</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="comment">// get as much data as possible.</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">// Rewrite salvaged data to wallet.dat</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="comment">// Set -rescan so any missing transactions will be</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">// found.</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <a class="code" href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> now = <a class="code" href="util_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    std::string newFilename = <a class="code" href="util_8h.html#a86c8651322c9dd7ba3abf64c088993be">strprintf</a>(<span class="stringliteral">&quot;wallet.%&quot;</span>PRId64<span class="stringliteral">&quot;.bak&quot;</span>, now);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordtype">int</span> result = dbenv.<a class="code" href="class_c_d_b_env.html#a50a70690e7f688f5e92a972e7fa18668">dbenv</a>.dbrename(NULL, filename.c_str(), NULL,</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                                      newFilename.c_str(), DB_AUTO_COMMIT);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">if</span> (result == 0)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Renamed %s to %s\n&quot;</span>, filename.c_str(), newFilename.c_str());</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Failed to rename %s to %s\n&quot;</span>, filename.c_str(), newFilename.c_str());</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    std::vector&lt;CDBEnv::KeyValPair&gt; salvagedData;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordtype">bool</span> allOK = dbenv.<a class="code" href="class_c_d_b_env.html#a08726637bff0809ab9c7c493383a3914">Salvage</a>(newFilename, <span class="keyword">true</span>, salvagedData);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">if</span> (salvagedData.empty())</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Salvage(aggressive) found no records in %s.\n&quot;</span>, newFilename.c_str());</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Salvage(aggressive) found %&quot;</span><a class="code" href="util_8h.html#a427f25ac1b36af6c08edcb5d7c481e3b">PRIszu</a><span class="stringliteral">&quot; records\n&quot;</span>, salvagedData.size());</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordtype">bool</span> fSuccess = allOK;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    Db* pdbCopy = <span class="keyword">new</span> Db(&amp;dbenv.<a class="code" href="class_c_d_b_env.html#a50a70690e7f688f5e92a972e7fa18668">dbenv</a>, 0);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordtype">int</span> ret = pdbCopy-&gt;open(NULL,                 <span class="comment">// Txn pointer</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                            filename.c_str(),   <span class="comment">// Filename</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                            <span class="stringliteral">&quot;main&quot;</span>,    <span class="comment">// Logical db name</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                            DB_BTREE,  <span class="comment">// Database type</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                            DB_CREATE,    <span class="comment">// Flags</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                            0);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">if</span> (ret &gt; 0)</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    {</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Cannot create database file %s\n&quot;</span>, filename.c_str());</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <a class="code" href="class_c_wallet.html">CWallet</a> dummyWallet;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <a class="code" href="class_c_wallet_scan_state.html">CWalletScanState</a> wss;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    DbTxn* ptxn = dbenv.<a class="code" href="class_c_d_b_env.html#a5f1daab338b2098ea693efad6edefb9b">TxnBegin</a>();</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    BOOST_FOREACH(<a class="code" href="class_c_d_b_env.html#a53fd285f09c312973caa6f90b33937f5">CDBEnv::KeyValPair</a>&amp; row, salvagedData)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    {</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="keywordflow">if</span> (fOnlyKeys)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <a class="code" href="class_c_data_stream.html">CDataStream</a> ssKey(row.first, <a class="code" href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a>, CLIENT_VERSION);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <a class="code" href="class_c_data_stream.html">CDataStream</a> ssValue(row.second, <a class="code" href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a>, CLIENT_VERSION);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <span class="keywordtype">string</span> strType, strErr;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keywordtype">bool</span> fReadOK = <a class="code" href="walletdb_8cpp.html#ad1f171cf096f5479805a06fc20480343">ReadKeyValue</a>(&amp;dummyWallet, ssKey, ssValue,</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                        wss, strType, strErr);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            <span class="keywordflow">if</span> (!IsKeyType(strType))</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            <span class="keywordflow">if</span> (!fReadOK)</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;WARNING: CWalletDB::Recover skipping %s: %s\n&quot;</span>, strType.c_str(), strErr.c_str());</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            }</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        }</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        Dbt datKey(&amp;row.first[0], row.first.size());</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        Dbt datValue(&amp;row.second[0], row.second.size());</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordtype">int</span> ret2 = pdbCopy-&gt;put(ptxn, &amp;datKey, &amp;datValue, DB_NOOVERWRITE);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">if</span> (ret2 &gt; 0)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            fSuccess = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    ptxn-&gt;commit(0);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    pdbCopy-&gt;close(0);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keyword">delete</span> pdbCopy;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">return</span> fSuccess;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;}</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno"><a class="line" href="class_c_wallet_d_b.html#a44388f1c3ee63191dcb78b1001e9390c">  716</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_wallet_d_b.html#a3ebeb12f37d9c66512e2bc2903a6854a">CWalletDB::Recover</a>(<a class="code" href="class_c_d_b_env.html">CDBEnv</a>&amp; dbenv, std::string filename)</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;{</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_c_wallet_d_b.html#a3ebeb12f37d9c66512e2bc2903a6854a">CWalletDB::Recover</a>(dbenv, filename, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;}</div>
<div class="ttc" id="util_8cpp_html_ab83866a054745d4b30a3948a1b44beba"><div class="ttname"><a href="util_8cpp.html#ab83866a054745d4b30a3948a1b44beba">GetDataDir</a></div><div class="ttdeci">const boost::filesystem::path &amp; GetDataDir(bool fNetSpecific)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l01020">util.cpp:1020</a></div></div>
<div class="ttc" id="db_8cpp_html_aad0b4d8ce794391063e82239d0a20b09"><div class="ttname"><a href="db_8cpp.html#aad0b4d8ce794391063e82239d0a20b09">nWalletDBUpdated</a></div><div class="ttdeci">unsigned int nWalletDBUpdated</div><div class="ttdef"><b>Definition:</b> <a href="db_8cpp_source.html#l00022">db.cpp:22</a></div></div>
<div class="ttc" id="class_c_wallet_html_a01fbd78238d4ef833d059f12a7e8ac9f"><div class="ttname"><a href="class_c_wallet.html#a01fbd78238d4ef833d059f12a7e8ac9f">CWallet::LoadCryptedKey</a></div><div class="ttdeci">bool LoadCryptedKey(const CPubKey &amp;vchPubKey, const std::vector&lt; unsigned char &gt; &amp;vchCryptedSecret)</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8cpp_source.html#l00168">wallet.cpp:168</a></div></div>
<div class="ttc" id="util_8h_html_a427f25ac1b36af6c08edcb5d7c481e3b"><div class="ttname"><a href="util_8h.html#a427f25ac1b36af6c08edcb5d7c481e3b">PRIszu</a></div><div class="ttdeci">#define PRIszu</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00065">util.h:65</a></div></div>
<div class="ttc" id="class_c_wallet_scan_state_html_a2cfbc8894839188b57be22e72f2d6de4"><div class="ttname"><a href="class_c_wallet_scan_state.html#a2cfbc8894839188b57be22e72f2d6de4">CWalletScanState::nKeyMeta</a></div><div class="ttdeci">unsigned int nKeyMeta</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00189">walletdb.cpp:189</a></div></div>
<div class="ttc" id="class_c_wallet_scan_state_html_a8a6e0071320cbfffc6d7d49ded5d506e"><div class="ttname"><a href="class_c_wallet_scan_state.html#a8a6e0071320cbfffc6d7d49ded5d506e">CWalletScanState::nKeys</a></div><div class="ttdeci">unsigned int nKeys</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00187">walletdb.cpp:187</a></div></div>
<div class="ttc" id="class_c_account_html"><div class="ttname"><a href="class_c_account.html">CAccount</a></div><div class="ttdoc">Account information. </div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00795">wallet.h:795</a></div></div>
<div class="ttc" id="class_c_wallet_html_a363fabb2b82d596c33e4fa3920a11c26"><div class="ttname"><a href="class_c_wallet.html#a363fabb2b82d596c33e4fa3920a11c26">CWallet::setKeyPool</a></div><div class="ttdeci">std::set&lt; int64_t &gt; setKeyPool</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00097">wallet.h:97</a></div></div>
<div class="ttc" id="class_c_wallet_scan_state_html_ad68ce61566ee2baf3d7b04b1390942d1"><div class="ttname"><a href="class_c_wallet_scan_state.html#ad68ce61566ee2baf3d7b04b1390942d1">CWalletScanState::nFileVersion</a></div><div class="ttdeci">int nFileVersion</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00192">walletdb.cpp:192</a></div></div>
<div class="ttc" id="util_8h_html_a86c8651322c9dd7ba3abf64c088993be"><div class="ttname"><a href="util_8h.html#a86c8651322c9dd7ba3abf64c088993be">strprintf</a></div><div class="ttdeci">#define strprintf(format,...)</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00161">util.h:161</a></div></div>
<div class="ttc" id="class_c_accounting_entry_html_a9c5f78f13a657c1f1fc860a70ef072d5"><div class="ttname"><a href="class_c_accounting_entry.html#a9c5f78f13a657c1f1fc860a70ef072d5">CAccountingEntry::nOrderPos</a></div><div class="ttdeci">int64_t nOrderPos</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00832">wallet.h:832</a></div></div>
<div class="ttc" id="class_c_d_b_env_html_a3b8a3caf48395ef3f05e3717b33bf32c"><div class="ttname"><a href="class_c_d_b_env.html#a3b8a3caf48395ef3f05e3717b33bf32c">CDBEnv::mapFileUseCount</a></div><div class="ttdeci">std::map&lt; std::string, int &gt; mapFileUseCount</div><div class="ttdef"><b>Definition:</b> <a href="db_8h_source.html#l00046">db.h:46</a></div></div>
<div class="ttc" id="class_c_wallet_tx_html_ab0ee7347584bff886dc24b9f63ff023c"><div class="ttname"><a href="class_c_wallet_tx.html#ab0ee7347584bff886dc24b9f63ff023c">CWalletTx::BindWallet</a></div><div class="ttdeci">void BindWallet(CWallet *pwalletIn)</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00555">wallet.h:555</a></div></div>
<div class="ttc" id="class_c_key_html_a243517185c6bb7697640fe5d2639077f"><div class="ttname"><a href="class_c_key.html#a243517185c6bb7697640fe5d2639077f">CKey::SetPubKey</a></div><div class="ttdeci">bool SetPubKey(const CPubKey &amp;vchPubKey)</div><div class="ttdef"><b>Definition:</b> <a href="key_8cpp_source.html#l00307">key.cpp:307</a></div></div>
<div class="ttc" id="class_c_d_b_env_html_aaf4c0dd43825ee2441eaa4177bef137b"><div class="ttname"><a href="class_c_d_b_env.html#aaf4c0dd43825ee2441eaa4177bef137b">CDBEnv::CheckpointLSN</a></div><div class="ttdeci">void CheckpointLSN(std::string strFile)</div><div class="ttdef"><b>Definition:</b> <a href="db_8cpp_source.html#l00224">db.cpp:224</a></div></div>
<div class="ttc" id="walletdb_8cpp_html_a0bc784e958b92854437f2238d4249da0"><div class="ttname"><a href="walletdb_8cpp.html#a0bc784e958b92854437f2238d4249da0">fWalletUnlockStakingOnly</a></div><div class="ttdeci">bool fWalletUnlockStakingOnly</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8cpp_source.html#l00185">wallet.cpp:185</a></div></div>
<div class="ttc" id="class_c_wallet_d_b_html_afef640a4990f74fd5af7178c99415cf3"><div class="ttname"><a href="class_c_wallet_d_b.html#afef640a4990f74fd5af7178c99415cf3">CWalletDB::WriteAccount</a></div><div class="ttdeci">bool WriteAccount(const std::string &amp;strAccount, const CAccount &amp;account)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00042">walletdb.cpp:42</a></div></div>
<div class="ttc" id="class_c_d_b_env_html_a5f1daab338b2098ea693efad6edefb9b"><div class="ttname"><a href="class_c_d_b_env.html#a5f1daab338b2098ea693efad6edefb9b">CDBEnv::TxnBegin</a></div><div class="ttdeci">DbTxn * TxnBegin(int flags=DB_TXN_WRITE_NOSYNC)</div><div class="ttdef"><b>Definition:</b> <a href="db_8h_source.html#l00080">db.h:80</a></div></div>
<div class="ttc" id="serialize_8h_html_aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d"><div class="ttname"><a href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a></div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00049">serialize.h:49</a></div></div>
<div class="ttc" id="sync_8h_html_aca08e7299069c2d60b8aa726fc550612"><div class="ttname"><a href="sync_8h.html#aca08e7299069c2d60b8aa726fc550612">TRY_LOCK</a></div><div class="ttdeci">#define TRY_LOCK(cs, name)</div><div class="ttdef"><b>Definition:</b> <a href="sync_8h_source.html#l00158">sync.h:158</a></div></div>
<div class="ttc" id="namespaceboost_html"><div class="ttname"><a href="namespaceboost.html">boost</a></div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00017">util.cpp:17</a></div></div>
<div class="ttc" id="class_c_wallet_html_a21e6580474514f838dfe1446890085a4"><div class="ttname"><a href="class_c_wallet.html#a21e6580474514f838dfe1446890085a4">CWallet::LoadKeyMetadata</a></div><div class="ttdeci">bool LoadKeyMetadata(const CPubKey &amp;pubkey, const CKeyMetadata &amp;metadata)</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8cpp_source.html#l00158">wallet.cpp:158</a></div></div>
<div class="ttc" id="class_c_key_metadata_html"><div class="ttname"><a href="class_c_key_metadata.html">CKeyMetadata</a></div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8h_source.html#l00026">walletdb.h:26</a></div></div>
<div class="ttc" id="class_c_wallet_html_a4e6eb889f7638ed9695fdc0731581428"><div class="ttname"><a href="class_c_wallet.html#a4e6eb889f7638ed9695fdc0731581428">CWallet::cs_wallet</a></div><div class="ttdeci">CCriticalSection cs_wallet</div><div class="ttdoc">Main wallet lock. </div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00092">wallet.h:92</a></div></div>
<div class="ttc" id="util_8h_html_ac635182d3e845eda4af4fa5ab31609da"><div class="ttname"><a href="util_8h.html#ac635182d3e845eda4af4fa5ab31609da">MilliSleep</a></div><div class="ttdeci">void MilliSleep(int64_t n)</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00101">util.h:101</a></div></div>
<div class="ttc" id="walletdb_8h_html_a7558d92e9ea1d446075da1b514c4a944ac83155a59a0d2ca8fc325075f58060c5"><div class="ttname"><a href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944ac83155a59a0d2ca8fc325075f58060c5">DB_NONCRITICAL_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8h_source.html#l00020">walletdb.h:20</a></div></div>
<div class="ttc" id="util_8cpp_html_acb3060cad083d342898b6055e43692ae"><div class="ttname"><a href="util_8cpp.html#acb3060cad083d342898b6055e43692ae">SoftSetBoolArg</a></div><div class="ttdeci">bool SoftSetBoolArg(const std::string &amp;strArg, bool fValue)</div><div class="ttdoc">Set a boolean argument if it doesn&#39;t already have a value. </div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00585">util.cpp:585</a></div></div>
<div class="ttc" id="class_c_wallet_html_a94c9cdf069f0bb17c09aca0580271359"><div class="ttname"><a href="class_c_wallet.html#a94c9cdf069f0bb17c09aca0580271359">CWallet::LoadKey</a></div><div class="ttdeci">bool LoadKey(const CKey &amp;key)</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00154">wallet.h:154</a></div></div>
<div class="ttc" id="class_c_wallet_html_a6d415899e530a91e6e28dd0fa4ecef8d"><div class="ttname"><a href="class_c_wallet.html#a6d415899e530a91e6e28dd0fa4ecef8d">CWallet::vchDefaultKey</a></div><div class="ttdeci">CPubKey vchDefaultKey</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00133">wallet.h:133</a></div></div>
<div class="ttc" id="class_c_master_key_html"><div class="ttname"><a href="class_c_master_key.html">CMasterKey</a></div><div class="ttdoc">Master key for wallet encryption. </div><div class="ttdef"><b>Definition:</b> <a href="crypter_8h_source.html#l00030">crypter.h:30</a></div></div>
<div class="ttc" id="class_c_wallet_tx_html_af51e160ff1d9d78986e9f239c7ac7a35"><div class="ttname"><a href="class_c_wallet_tx.html#af51e160ff1d9d78986e9f239c7ac7a35">CWalletTx::nOrderPos</a></div><div class="ttdeci">int64_t nOrderPos</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00414">wallet.h:414</a></div></div>
<div class="ttc" id="walletdb_8h_html_a7558d92e9ea1d446075da1b514c4a944a5eb73e7d323c832e22611f0ff94b1655"><div class="ttname"><a href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944a5eb73e7d323c832e22611f0ff94b1655">DB_CORRUPT</a></div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8h_source.html#l00019">walletdb.h:19</a></div></div>
<div class="ttc" id="class_c_wallet_scan_state_html"><div class="ttname"><a href="class_c_wallet_scan_state.html">CWalletScanState</a></div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00185">walletdb.cpp:185</a></div></div>
<div class="ttc" id="class_c_transaction_html_a3f8666d2a275c40da14bd5eaf47dc004"><div class="ttname"><a href="class_c_transaction.html#a3f8666d2a275c40da14bd5eaf47dc004">CTransaction::GetHash</a></div><div class="ttdeci">uint256 GetHash() const </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00483">main.h:483</a></div></div>
<div class="ttc" id="class_c_wallet_html_a817c0d1034377a7bd70a714140a5a8ca"><div class="ttname"><a href="class_c_wallet.html#a817c0d1034377a7bd70a714140a5a8ca">CWallet::nTimeFirstKey</a></div><div class="ttdeci">int64_t nTimeFirstKey</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00134">wallet.h:134</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div></div>
<div class="ttc" id="class_c_wallet_d_b_html_a51555c82291fe16081880110541e207f"><div class="ttname"><a href="class_c_wallet_d_b.html#a51555c82291fe16081880110541e207f">CWalletDB::ListAccountCreditDebit</a></div><div class="ttdeci">void ListAccountCreditDebit(const std::string &amp;strAccount, std::list&lt; CAccountingEntry &gt; &amp;acentries)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00069">walletdb.cpp:69</a></div></div>
<div class="ttc" id="class_c_account_html_ac63a4127fd899a21a5916a86588e809a"><div class="ttname"><a href="class_c_account.html#ac63a4127fd899a21a5916a86588e809a">CAccount::SetNull</a></div><div class="ttdeci">void SetNull()</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00805">wallet.h:805</a></div></div>
<div class="ttc" id="class_c_data_stream_html"><div class="ttname"><a href="class_c_data_stream.html">CDataStream</a></div><div class="ttdoc">Double ended buffer combining vector and stream-like interfaces. </div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00744">serialize.h:744</a></div></div>
<div class="ttc" id="class_c_bitcoin_address_html"><div class="ttname"><a href="class_c_bitcoin_address.html">CBitcoinAddress</a></div><div class="ttdef"><b>Definition:</b> <a href="base58_8h_source.html#l00274">base58.h:274</a></div></div>
<div class="ttc" id="class_c_wallet_d_b_html_ad96920c48370b68b08f9530516edecf2"><div class="ttname"><a href="class_c_wallet_d_b.html#ad96920c48370b68b08f9530516edecf2">CWalletDB::WriteAccountingEntry</a></div><div class="ttdeci">bool WriteAccountingEntry(const uint64_t nAccEntryNum, const CAccountingEntry &amp;acentry)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00047">walletdb.cpp:47</a></div></div>
<div class="ttc" id="class_c_wallet_scan_state_html_ae1316ee4cfdf8fbff91ca32a5d0f2b6a"><div class="ttname"><a href="class_c_wallet_scan_state.html#ae1316ee4cfdf8fbff91ca32a5d0f2b6a">CWalletScanState::nCKeys</a></div><div class="ttdeci">unsigned int nCKeys</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00188">walletdb.cpp:188</a></div></div>
<div class="ttc" id="wallet_8h_html"><div class="ttname"><a href="wallet_8h.html">wallet.h</a></div></div>
<div class="ttc" id="walletdb_8cpp_html_a273c3692765c732c5f724cec93e6b62f"><div class="ttname"><a href="walletdb_8cpp.html#a273c3692765c732c5f724cec93e6b62f">BackupWallet</a></div><div class="ttdeci">bool BackupWallet(const CWallet &amp;wallet, const string &amp;strDest)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00595">walletdb.cpp:595</a></div></div>
<div class="ttc" id="walletdb_8h_html_a7558d92e9ea1d446075da1b514c4a944"><div class="ttname"><a href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944">DBErrors</a></div><div class="ttdeci">DBErrors</div><div class="ttdoc">Error statuses for the wallet database. </div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8h_source.html#l00016">walletdb.h:16</a></div></div>
<div class="ttc" id="class_c_bitcoin_address_html_a46d632250c4b47727f8e9b2f8141fd69"><div class="ttname"><a href="class_c_bitcoin_address.html#a46d632250c4b47727f8e9b2f8141fd69">CBitcoinAddress::Get</a></div><div class="ttdeci">CTxDestination Get() const </div><div class="ttdef"><b>Definition:</b> <a href="base58_8h_source.html#l00349">base58.h:349</a></div></div>
<div class="ttc" id="util_8cpp_html_a85fc1244e0bd3c91ee7a1c05ed10ebbb"><div class="ttname"><a href="util_8cpp.html#a85fc1244e0bd3c91ee7a1c05ed10ebbb">RenameThread</a></div><div class="ttdeci">void RenameThread(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l01322">util.cpp:1322</a></div></div>
<div class="ttc" id="walletdb_8h_html_a7558d92e9ea1d446075da1b514c4a944a0e0f7a1f3a38544a975bd97fba1eed58"><div class="ttname"><a href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944a0e0f7a1f3a38544a975bd97fba1eed58">DB_TOO_NEW</a></div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8h_source.html#l00021">walletdb.h:21</a></div></div>
<div class="ttc" id="db_8cpp_html_a0e3d95be19da4a302447fa44703b1979"><div class="ttname"><a href="db_8cpp.html#a0e3d95be19da4a302447fa44703b1979">bitdb</a></div><div class="ttdeci">CDBEnv bitdb</div><div class="ttdef"><b>Definition:</b> <a href="db_8cpp_source.html#l00030">db.cpp:30</a></div></div>
<div class="ttc" id="key_8h_html_a1da569b8b6e5b3fa1196cc1b877e7f54"><div class="ttname"><a href="key_8h.html#a1da569b8b6e5b3fa1196cc1b877e7f54">CPrivKey</a></div><div class="ttdeci">std::vector&lt; unsigned char, secure_allocator&lt; unsigned char &gt; &gt; CPrivKey</div><div class="ttdef"><b>Definition:</b> <a href="key_8h_source.html#l00104">key.h:104</a></div></div>
<div class="ttc" id="walletdb_8h_html_a7558d92e9ea1d446075da1b514c4a944ab5a338e1c914e0d9107fab0dbcd3c64c"><div class="ttname"><a href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944ab5a338e1c914e0d9107fab0dbcd3c64c">DB_LOAD_FAIL</a></div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8h_source.html#l00022">walletdb.h:22</a></div></div>
<div class="ttc" id="util_8cpp_html_a64d956f1dda7f9a80ab5d594532b906d"><div class="ttname"><a href="util_8cpp.html#a64d956f1dda7f9a80ab5d594532b906d">GetBoolArg</a></div><div class="ttdeci">bool GetBoolArg(const std::string &amp;strArg, bool fDefault)</div><div class="ttdoc">Return boolean argument or default value. </div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00562">util.cpp:562</a></div></div>
<div class="ttc" id="class_c_wallet_html_aecfc6e4a6ea958ec369ca77d790271e3"><div class="ttname"><a href="class_c_wallet.html#aecfc6e4a6ea958ec369ca77d790271e3">CWallet::nMasterKeyMaxID</a></div><div class="ttdeci">unsigned int nMasterKeyMaxID</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00103">wallet.h:103</a></div></div>
<div class="ttc" id="class_c_accounting_entry_html_a0c35da8adbbc529238af70964e0d2b29"><div class="ttname"><a href="class_c_accounting_entry.html#a0c35da8adbbc529238af70964e0d2b29">CAccountingEntry::nEntryNo</a></div><div class="ttdeci">uint64_t nEntryNo</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00833">wallet.h:833</a></div></div>
<div class="ttc" id="class_c_wallet_d_b_html_a7b853e605ddba528896e60c766b59075"><div class="ttname"><a href="class_c_wallet_d_b.html#a7b853e605ddba528896e60c766b59075">CWalletDB::GetAccountCreditDebit</a></div><div class="ttdeci">int64_t GetAccountCreditDebit(const std::string &amp;strAccount)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00057">walletdb.cpp:57</a></div></div>
<div class="ttc" id="class_c_key_html_ae4b61da6ec62f676fe6362ac5fc26aca"><div class="ttname"><a href="class_c_key.html#ae4b61da6ec62f676fe6362ac5fc26aca">CKey::GetPubKey</a></div><div class="ttdeci">CPubKey GetPubKey() const </div><div class="ttdef"><b>Definition:</b> <a href="key_8cpp_source.html#l00322">key.cpp:322</a></div></div>
<div class="ttc" id="class_c_accounting_entry_html_abb080aaba00c27e0414904fb956aad2b"><div class="ttname"><a href="class_c_accounting_entry.html#abb080aaba00c27e0414904fb956aad2b">CAccountingEntry::nCreditDebit</a></div><div class="ttdeci">int64_t nCreditDebit</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00827">wallet.h:827</a></div></div>
<div class="ttc" id="sync_8h_html_a911fe23f057c2fe5aad629162d6c99d0"><div class="ttname"><a href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a></div><div class="ttdeci">#define LOCK(cs)</div><div class="ttdef"><b>Definition:</b> <a href="sync_8h_source.html#l00156">sync.h:156</a></div></div>
<div class="ttc" id="class_c_wallet_d_b_html_ad1b3bce77e9dd6ddd8c668a469c38f0a"><div class="ttname"><a href="class_c_wallet_d_b.html#ad1b3bce77e9dd6ddd8c668a469c38f0a">CWalletDB::WriteName</a></div><div class="ttdeci">bool WriteName(const std::string &amp;strAddress, const std::string &amp;strName)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00022">walletdb.cpp:22</a></div></div>
<div class="ttc" id="class_c_wallet_d_b_html_a14f26e53502d1a60dd2b034f830acf03"><div class="ttname"><a href="class_c_wallet_d_b.html#a14f26e53502d1a60dd2b034f830acf03">CWalletDB::LoadWallet</a></div><div class="ttdeci">DBErrors LoadWallet(CWallet *pwallet)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00433">walletdb.cpp:433</a></div></div>
<div class="ttc" id="stdint_8h_html_aaa5d1cd013383c889537491c3cfd9aad"><div class="ttname"><a href="stdint_8h.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a></div><div class="ttdeci">unsigned long long uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00022">stdint.h:22</a></div></div>
<div class="ttc" id="class_c_pub_key_html"><div class="ttname"><a href="class_c_pub_key.html">CPubKey</a></div><div class="ttdoc">An encapsulated public key. </div><div class="ttdef"><b>Definition:</b> <a href="key_8h_source.html#l00064">key.h:64</a></div></div>
<div class="ttc" id="bitcoinrpc_8cpp_html_a3cb9f0894fab1c8fbb0753c9c7c2a8d9"><div class="ttname"><a href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a></div><div class="ttdeci">#define printf</div><div class="ttdef"><b>Definition:</b> <a href="bitcoinrpc_8cpp_source.html#l00028">bitcoinrpc.cpp:28</a></div></div>
<div class="ttc" id="class_c_wallet_scan_state_html_a8012f2b0c336f7ee0b842d875f4fa4e6"><div class="ttname"><a href="class_c_wallet_scan_state.html#a8012f2b0c336f7ee0b842d875f4fa4e6">CWalletScanState::CWalletScanState</a></div><div class="ttdeci">CWalletScanState()</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00195">walletdb.cpp:195</a></div></div>
<div class="ttc" id="class_c_key_html_a4f5fd24b068dbbe49a0f9e28d69fef5d"><div class="ttname"><a href="class_c_key.html#a4f5fd24b068dbbe49a0f9e28d69fef5d">CKey::SetPrivKey</a></div><div class="ttdeci">bool SetPrivKey(const CPrivKey &amp;vchPrivKey)</div><div class="ttdef"><b>Definition:</b> <a href="key_8cpp_source.html#l00234">key.cpp:234</a></div></div>
<div class="ttc" id="util_8h_html_a139d0fe6387b9e230a9b8bb12d9b43b9"><div class="ttname"><a href="util_8h.html#a139d0fe6387b9e230a9b8bb12d9b43b9">GetTimeMillis</a></div><div class="ttdeci">int64_t GetTimeMillis()</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00323">util.h:323</a></div></div>
<div class="ttc" id="class_c_d_b_env_html_af71bf28f9142c38aedc550353270b2b7"><div class="ttname"><a href="class_c_d_b_env.html#af71bf28f9142c38aedc550353270b2b7">CDBEnv::cs_db</a></div><div class="ttdeci">CCriticalSection cs_db</div><div class="ttdef"><b>Definition:</b> <a href="db_8h_source.html#l00044">db.h:44</a></div></div>
<div class="ttc" id="util_8cpp_html_a5f70d0c660389bbdbd3fe69af14c9161"><div class="ttname"><a href="util_8cpp.html#a5f70d0c660389bbdbd3fe69af14c9161">fShutdown</a></div><div class="ttdeci">bool fShutdown</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00067">util.cpp:67</a></div></div>
<div class="ttc" id="class_c_wallet_scan_state_html_acafa7b6a27ec1a4714e9a7b331067e9d"><div class="ttname"><a href="class_c_wallet_scan_state.html#acafa7b6a27ec1a4714e9a7b331067e9d">CWalletScanState::fAnyUnordered</a></div><div class="ttdeci">bool fAnyUnordered</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00191">walletdb.cpp:191</a></div></div>
<div class="ttc" id="class_c_wallet_html_adbf0abef9da8102f000d4afd5cec5bbc"><div class="ttname"><a href="class_c_wallet.html#adbf0abef9da8102f000d4afd5cec5bbc">CWallet::LoadCScript</a></div><div class="ttdeci">bool LoadCScript(const CScript &amp;redeemScript)</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8cpp_source.html#l00187">wallet.cpp:187</a></div></div>
<div class="ttc" id="class_c_wallet_scan_state_html_a6cbf626ca5a0275f0469684f22dff12f"><div class="ttname"><a href="class_c_wallet_scan_state.html#a6cbf626ca5a0275f0469684f22dff12f">CWalletScanState::vWalletUpgrade</a></div><div class="ttdeci">vector&lt; uint256 &gt; vWalletUpgrade</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00193">walletdb.cpp:193</a></div></div>
<div class="ttc" id="util_8cpp_html_a46fac5fba8ba905b5f9acb364f5d8c6f"><div class="ttname"><a href="util_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a></div><div class="ttdeci">int64_t GetTime()</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l01157">util.cpp:1157</a></div></div>
<div class="ttc" id="class_c_wallet_html_a88317da8dab80135b8db73e945e15b60"><div class="ttname"><a href="class_c_wallet.html#a88317da8dab80135b8db73e945e15b60">CWallet::LoadMinVersion</a></div><div class="ttdeci">bool LoadMinVersion(int nVersion)</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00158">wallet.h:158</a></div></div>
<div class="ttc" id="class_c_wallet_tx_html"><div class="ttname"><a href="class_c_wallet_tx.html">CWalletTx</a></div><div class="ttdoc">A transaction with a bunch of additional info that only the owner cares about. </div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00399">wallet.h:399</a></div></div>
<div class="ttc" id="walletdb_8h_html_a7558d92e9ea1d446075da1b514c4a944aef89bee2c244fcd980d6cf7edc5bf2d6"><div class="ttname"><a href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944aef89bee2c244fcd980d6cf7edc5bf2d6">DB_NEED_REWRITE</a></div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8h_source.html#l00023">walletdb.h:23</a></div></div>
<div class="ttc" id="class_c_wallet_d_b_html_afc27d9c9eef8b31851e6b02dc3191425"><div class="ttname"><a href="class_c_wallet_d_b.html#afc27d9c9eef8b31851e6b02dc3191425">CWalletDB::ReorderTransactions</a></div><div class="ttdeci">DBErrors ReorderTransactions(CWallet *)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00114">walletdb.cpp:114</a></div></div>
<div class="ttc" id="class_c_wallet_html_a3e886f3a3b20228770e082b3fc014fc7"><div class="ttname"><a href="class_c_wallet.html#a3e886f3a3b20228770e082b3fc014fc7">CWallet::strWalletFile</a></div><div class="ttdeci">std::string strWalletFile</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00095">wallet.h:95</a></div></div>
<div class="ttc" id="class_c_wallet_html_a1b2e285b4d7bd105c792941aa666249c"><div class="ttname"><a href="class_c_wallet.html#a1b2e285b4d7bd105c792941aa666249c">CWallet::fFileBacked</a></div><div class="ttdeci">bool fFileBacked</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00094">wallet.h:94</a></div></div>
<div class="ttc" id="classuint256_html"><div class="ttname"><a href="classuint256.html">uint256</a></div><div class="ttdoc">256-bit unsigned integer </div><div class="ttdef"><b>Definition:</b> <a href="uint256_8h_source.html#l00517">uint256.h:517</a></div></div>
<div class="ttc" id="walletdb_8h_html"><div class="ttname"><a href="walletdb_8h.html">walletdb.h</a></div></div>
<div class="ttc" id="class_c_d_b_env_html_a08726637bff0809ab9c7c493383a3914"><div class="ttname"><a href="class_c_d_b_env.html#a08726637bff0809ab9c7c493383a3914">CDBEnv::Salvage</a></div><div class="ttdeci">bool Salvage(std::string strFile, bool fAggressive, std::vector&lt; KeyValPair &gt; &amp;vResult)</div><div class="ttdef"><b>Definition:</b> <a href="db_8cpp_source.html#l00169">db.cpp:169</a></div></div>
<div class="ttc" id="class_c_wallet_html_a23c5badf56c297a95557af3073d4aa32"><div class="ttname"><a href="class_c_wallet.html#a23c5badf56c297a95557af3073d4aa32">CWallet::mapMasterKeys</a></div><div class="ttdeci">MasterKeyMap mapMasterKeys</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00102">wallet.h:102</a></div></div>
<div class="ttc" id="walletdb_8h_html_a7558d92e9ea1d446075da1b514c4a944aa2367ec374804930406cea446fbb3fd2"><div class="ttname"><a href="walletdb_8h.html#a7558d92e9ea1d446075da1b514c4a944aa2367ec374804930406cea446fbb3fd2">DB_LOAD_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8h_source.html#l00018">walletdb.h:18</a></div></div>
<div class="ttc" id="class_c_script_html"><div class="ttname"><a href="class_c_script.html">CScript</a></div><div class="ttdoc">Serialized script, used inside transaction inputs and outputs. </div><div class="ttdef"><b>Definition:</b> <a href="script_8h_source.html#l00239">script.h:239</a></div></div>
<div class="ttc" id="class_c_wallet_html_af56cb17b19742506fc8d9449fc60884e"><div class="ttname"><a href="class_c_wallet.html#af56cb17b19742506fc8d9449fc60884e">CWallet::nOrderPosNext</a></div><div class="ttdeci">int64_t nOrderPosNext</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00128">wallet.h:128</a></div></div>
<div class="ttc" id="class_c_d_b_env_html_ac53fd53afdd1e0881b8ffbb11a89b556"><div class="ttname"><a href="class_c_d_b_env.html#ac53fd53afdd1e0881b8ffbb11a89b556">CDBEnv::CloseDb</a></div><div class="ttdeci">void CloseDb(const std::string &amp;strFile)</div><div class="ttdef"><b>Definition:</b> <a href="db_8cpp_source.html#l00318">db.cpp:318</a></div></div>
<div class="ttc" id="class_c_wallet_d_b_html_a3ebeb12f37d9c66512e2bc2903a6854a"><div class="ttname"><a href="class_c_wallet_d_b.html#a3ebeb12f37d9c66512e2bc2903a6854a">CWalletDB::Recover</a></div><div class="ttdeci">static bool Recover(CDBEnv &amp;dbenv, std::string filename, bool fOnlyKeys)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00638">walletdb.cpp:638</a></div></div>
<div class="ttc" id="class_c_wallet_key_html"><div class="ttname"><a href="class_c_wallet_key.html">CWalletKey</a></div><div class="ttdoc">Private key that includes an expiration date in case it never gets used. </div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00760">wallet.h:760</a></div></div>
<div class="ttc" id="class_c_key_i_d_html"><div class="ttname"><a href="class_c_key_i_d.html">CKeyID</a></div><div class="ttdoc">A reference to a CKey: the Hash160 of its serialized public key. </div><div class="ttdef"><b>Definition:</b> <a href="key_8h_source.html#l00048">key.h:48</a></div></div>
<div class="ttc" id="class_c_accounting_entry_html"><div class="ttname"><a href="class_c_accounting_entry.html">CAccountingEntry</a></div><div class="ttdoc">Internal transfers. </div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00823">wallet.h:823</a></div></div>
<div class="ttc" id="class_c_d_b_env_html"><div class="ttname"><a href="class_c_d_b_env.html">CDBEnv</a></div><div class="ttdef"><b>Definition:</b> <a href="db_8h_source.html#l00033">db.h:33</a></div></div>
<div class="ttc" id="class_c_wallet_scan_state_html_a13c5139c5966079d1be4c739666c5243"><div class="ttname"><a href="class_c_wallet_scan_state.html#a13c5139c5966079d1be4c739666c5243">CWalletScanState::fIsEncrypted</a></div><div class="ttdeci">bool fIsEncrypted</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00190">walletdb.cpp:190</a></div></div>
<div class="ttc" id="walletdb_8cpp_html_a33aac5a93b3a2c27bd38315370aaf829"><div class="ttname"><a href="walletdb_8cpp.html#a33aac5a93b3a2c27bd38315370aaf829">ThreadFlushWalletDB</a></div><div class="ttdeci">void ThreadFlushWalletDB(void *parg)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00533">walletdb.cpp:533</a></div></div>
<div class="ttc" id="class_c_wallet_html"><div class="ttname"><a href="class_c_wallet.html">CWallet</a></div><div class="ttdoc">A CWallet is an extension of a keystore, which also maintains a set of transactions and balances...</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00071">wallet.h:71</a></div></div>
<div class="ttc" id="classuint160_html"><div class="ttname"><a href="classuint160.html">uint160</a></div><div class="ttdoc">160-bit unsigned integer </div><div class="ttdef"><b>Definition:</b> <a href="uint256_8h_source.html#l00402">uint256.h:402</a></div></div>
<div class="ttc" id="class_c_wallet_html_acfd09bc5a2daee930f9f988efac8dbb7"><div class="ttname"><a href="class_c_wallet.html#acfd09bc5a2daee930f9f988efac8dbb7">CWallet::mapKeyMetadata</a></div><div class="ttdeci">std::map&lt; CKeyID, CKeyMetadata &gt; mapKeyMetadata</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00098">wallet.h:98</a></div></div>
<div class="ttc" id="walletdb_8cpp_html_ad1f171cf096f5479805a06fc20480343"><div class="ttname"><a href="walletdb_8cpp.html#ad1f171cf096f5479805a06fc20480343">ReadKeyValue</a></div><div class="ttdeci">bool ReadKeyValue(CWallet *pwallet, CDataStream &amp;ssKey, CDataStream &amp;ssValue, CWalletScanState &amp;wss, string &amp;strType, string &amp;strErr)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00204">walletdb.cpp:204</a></div></div>
<div class="ttc" id="class_c_wallet_html_afed31f2489c987e0f76233121ed84ab7"><div class="ttname"><a href="class_c_wallet.html#afed31f2489c987e0f76233121ed84ab7">CWallet::mapAddressBook</a></div><div class="ttdeci">std::map&lt; CTxDestination, std::string &gt; mapAddressBook</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00131">wallet.h:131</a></div></div>
<div class="ttc" id="class_c_wallet_html_a0b17f72f2170090f2de43a6c48af3214"><div class="ttname"><a href="class_c_wallet.html#a0b17f72f2170090f2de43a6c48af3214">CWallet::mapWallet</a></div><div class="ttdeci">std::map&lt; uint256, CWalletTx &gt; mapWallet</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00127">wallet.h:127</a></div></div>
<div class="ttc" id="stdint_8h_html_adec1df1b8b51cb32b77e5b86fff46471"><div class="ttname"><a href="stdint_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a></div><div class="ttdeci">signed long long int64_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00018">stdint.h:18</a></div></div>
<div class="ttc" id="class_c_d_b_env_html_a50a70690e7f688f5e92a972e7fa18668"><div class="ttname"><a href="class_c_d_b_env.html#a50a70690e7f688f5e92a972e7fa18668">CDBEnv::dbenv</a></div><div class="ttdeci">DbEnv dbenv</div><div class="ttdef"><b>Definition:</b> <a href="db_8h_source.html#l00045">db.h:45</a></div></div>
<div class="ttc" id="class_c_wallet_tx_html_af4f4b58875061467026da7b259532b69"><div class="ttname"><a href="class_c_wallet_tx.html#af4f4b58875061467026da7b259532b69">CWalletTx::nTimeReceived</a></div><div class="ttdeci">unsigned int nTimeReceived</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00409">wallet.h:409</a></div></div>
<div class="ttc" id="class_c_key_html"><div class="ttname"><a href="class_c_key.html">CKey</a></div><div class="ttdoc">An encapsulated OpenSSL Elliptic Curve key (public and/or private) </div><div class="ttdef"><b>Definition:</b> <a href="key_8h_source.html#l00109">key.h:109</a></div></div>
<div class="ttc" id="class_c_wallet_d_b_html_a319209fcf90ea860b668b92c44a3fa7a"><div class="ttname"><a href="class_c_wallet_d_b.html#a319209fcf90ea860b668b92c44a3fa7a">CWalletDB::EraseName</a></div><div class="ttdeci">bool EraseName(const std::string &amp;strAddress)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00028">walletdb.cpp:28</a></div></div>
<div class="ttc" id="class_c_d_b_env_html_a53fd285f09c312973caa6f90b33937f5"><div class="ttname"><a href="class_c_d_b_env.html#a53fd285f09c312973caa6f90b33937f5">CDBEnv::KeyValPair</a></div><div class="ttdeci">std::pair&lt; std::vector&lt; unsigned char &gt;, std::vector&lt; unsigned char &gt; &gt; KeyValPair</div><div class="ttdef"><b>Definition:</b> <a href="db_8h_source.html#l00069">db.h:69</a></div></div>
<div class="ttc" id="class_c_key_html_a1f368a65eb50efe5b4dff5a481795dec"><div class="ttname"><a href="class_c_key.html#a1f368a65eb50efe5b4dff5a481795dec">CKey::IsValid</a></div><div class="ttdeci">bool IsValid()</div><div class="ttdef"><b>Definition:</b> <a href="key_8cpp_source.html#l00449">key.cpp:449</a></div></div>
<div class="ttc" id="cache_8cc_html_a11ecb029164e055f28f4123ce3748862"><div class="ttname"><a href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a></div><div class="ttdeci">uint32_t hash</div><div class="ttdef"><b>Definition:</b> <a href="cache_8cc_source.html#l00034">cache.cc:34</a></div></div>
<div class="ttc" id="class_c_wallet_d_b_html_afa8d9d374072629b360adb49b9bdd584"><div class="ttname"><a href="class_c_wallet_d_b.html#afa8d9d374072629b360adb49b9bdd584">CWalletDB::ReadAccount</a></div><div class="ttdeci">bool ReadAccount(const std::string &amp;strAccount, CAccount &amp;account)</div><div class="ttdef"><b>Definition:</b> <a href="walletdb_8cpp_source.html#l00036">walletdb.cpp:36</a></div></div>
<div class="ttc" id="class_c_accounting_entry_html_a416a4eb8d47e4c4cfdfc366d9d777ae6"><div class="ttname"><a href="class_c_accounting_entry.html#a416a4eb8d47e4c4cfdfc366d9d777ae6">CAccountingEntry::nTime</a></div><div class="ttdeci">int64_t nTime</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00828">wallet.h:828</a></div></div>
<div class="ttc" id="class_c_data_stream_html_a6e50e788d33080ac804e4d8ba7150279"><div class="ttname"><a href="class_c_data_stream.html#a6e50e788d33080ac804e4d8ba7150279">CDataStream::empty</a></div><div class="ttdeci">bool empty() const </div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00834">serialize.h:834</a></div></div>
<div class="ttc" id="class_c_key_pool_html"><div class="ttname"><a href="class_c_key_pool.html">CKeyPool</a></div><div class="ttdoc">A key pool entry. </div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00041">wallet.h:41</a></div></div>
<div class="ttc" id="class_c_accounting_entry_html_a01434c1b0edad576bc1584c9b667ce1d"><div class="ttname"><a href="class_c_accounting_entry.html#a01434c1b0edad576bc1584c9b667ce1d">CAccountingEntry::strAccount</a></div><div class="ttdeci">std::string strAccount</div><div class="ttdef"><b>Definition:</b> <a href="wallet_8h_source.html#l00826">wallet.h:826</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 14 2015 11:20:03 for Bitcoin by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
