<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Bitcoin: src/txdb-leveldb.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bitcoin_logo_doxygen.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bitcoin
   &#160;<span id="projectnumber">0.5.0</span>
   </div>
   <div id="projectbrief">P2P Digital Currency</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_a5a49bdec207fb1b0616d2e91de4c093.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">txdb-leveldb.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="txdb-leveldb_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright (c) 2009-2010 Satoshi Nakamoto</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Copyright (c) 2009-2012 The Bitcoin developers</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Distributed under the MIT/X11 software license, see the accompanying</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// file license.txt or http://www.opensource.org/licenses/mit-license.php.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;boost/version.hpp&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;boost/filesystem.hpp&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;boost/filesystem/fstream.hpp&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="env_8h.html">leveldb/env.h</a>&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="cache_8h.html">leveldb/cache.h</a>&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="filter__policy_8h.html">leveldb/filter_policy.h</a>&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="memenv_8h.html">memenv/memenv.h</a>&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="kernel_8h.html">kernel.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="checkpoints_8h.html">checkpoints.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="txdb_8h.html">txdb.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">util.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="main_8h.html">main.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespaceboost.html">boost</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="txdb-leveldb_8cpp.html#a72eff8ae1d84de13daf97a61b8c02bc6">   26</a></span>&#160;<a class="code" href="classleveldb_1_1_d_b.html">leveldb::DB</a> *<a class="code" href="txdb-leveldb_8cpp.html#a72eff8ae1d84de13daf97a61b8c02bc6">txdb</a>; <span class="comment">// global pointer for LevelDB object instance</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">static</span> <a class="code" href="structleveldb_1_1_options.html">leveldb::Options</a> GetOptions() {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <a class="code" href="structleveldb_1_1_options.html">leveldb::Options</a> options;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordtype">int</span> nCacheSizeMB = <a class="code" href="util_8cpp.html#a24f685720bf40370e5bd2a192ad50cd8">GetArg</a>(<span class="stringliteral">&quot;-dbcache&quot;</span>, 25);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    options.<a class="code" href="structleveldb_1_1_options.html#a4e87749ebac1ba28dff6bb63eb2059e5">block_cache</a> = <a class="code" href="namespaceleveldb.html#a231e1b41322a8b342c91a15a78e425d4">leveldb::NewLRUCache</a>(nCacheSizeMB * 1048576);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    options.<a class="code" href="structleveldb_1_1_options.html#a24c88997a866d535e68de15b5c3cd02b">filter_policy</a> = <a class="code" href="namespaceleveldb.html#ae6b34bf2331983721554f284b1eaa1a1">leveldb::NewBloomFilterPolicy</a>(10);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordflow">return</span> options;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="txdb-leveldb_8cpp.html#a9a8c309c31bb9f6feadef44982002926">   36</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="txdb-leveldb_8cpp.html#a9a8c309c31bb9f6feadef44982002926">init_blockindex</a>(<a class="code" href="structleveldb_1_1_options.html">leveldb::Options</a>&amp; options, <span class="keywordtype">bool</span> fRemoveOld = <span class="keyword">false</span>) {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">// First time init.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    filesystem::path directory = <a class="code" href="util_8cpp.html#ab83866a054745d4b30a3948a1b44beba">GetDataDir</a>() / <span class="stringliteral">&quot;txleveldb&quot;</span>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span> (fRemoveOld) {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        filesystem::remove_all(directory); <span class="comment">// remove directory</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nFile = 1;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            filesystem::path strBlockFile = <a class="code" href="util_8cpp.html#ab83866a054745d4b30a3948a1b44beba">GetDataDir</a>() / <a class="code" href="util_8h.html#a86c8651322c9dd7ba3abf64c088993be">strprintf</a>(<span class="stringliteral">&quot;blk%04u.dat&quot;</span>, nFile);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            <span class="comment">// Break if no such file</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            <span class="keywordflow">if</span>( !filesystem::exists( strBlockFile ) )</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            filesystem::remove(strBlockFile);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            nFile++;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    filesystem::create_directory(directory);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Opening LevelDB in %s\n&quot;</span>, directory.string().c_str());</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="classleveldb_1_1_status.html">leveldb::Status</a> status = <a class="code" href="classleveldb_1_1_d_b.html#ac1da2b48e911287d86f3a3bfa0f851fe">leveldb::DB::Open</a>(options, directory.string(), &amp;<a class="code" href="txdb-leveldb_8cpp.html#a72eff8ae1d84de13daf97a61b8c02bc6">txdb</a>);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keywordflow">throw</span> runtime_error(<a class="code" href="util_8h.html#a86c8651322c9dd7ba3abf64c088993be">strprintf</a>(<span class="stringliteral">&quot;init_blockindex(): error opening database environment %s&quot;</span>, status.ToString().c_str()));</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">// CDB subclasses are created and destroyed VERY OFTEN. That&#39;s why</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">// we shouldn&#39;t treat this as a free operations.</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a15efd656b7f86b0abf8d99183cae493a">   68</a></span>&#160;<a class="code" href="class_c_tx_d_b.html#a15efd656b7f86b0abf8d99183cae493a">CTxDB::CTxDB</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* pszMode)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;{</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    assert(pszMode);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    activeBatch = NULL;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    fReadOnly = (!strchr(pszMode, <span class="charliteral">&#39;+&#39;</span>) &amp;&amp; !strchr(pszMode, <span class="charliteral">&#39;w&#39;</span>));</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> (txdb) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        pdb = <a class="code" href="txdb-leveldb_8cpp.html#a72eff8ae1d84de13daf97a61b8c02bc6">txdb</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordtype">bool</span> fCreate = strchr(pszMode, <span class="charliteral">&#39;c&#39;</span>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    options = GetOptions();</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    options.create_if_missing = fCreate;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    options.filter_policy = <a class="code" href="namespaceleveldb.html#ae6b34bf2331983721554f284b1eaa1a1">leveldb::NewBloomFilterPolicy</a>(10);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="txdb-leveldb_8cpp.html#a9a8c309c31bb9f6feadef44982002926">init_blockindex</a>(options); <span class="comment">// Init directory</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    pdb = <a class="code" href="txdb-leveldb_8cpp.html#a72eff8ae1d84de13daf97a61b8c02bc6">txdb</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> (Exists(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;version&quot;</span>)))</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        ReadVersion(nVersion);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Transaction index version is %d\n&quot;</span>, nVersion);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span> (nVersion &lt; DATABASE_VERSION)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Required index version is %d, removing old database\n&quot;</span>, DATABASE_VERSION);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="comment">// Leveldb instance destruction</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keyword">delete</span> <a class="code" href="txdb-leveldb_8cpp.html#a72eff8ae1d84de13daf97a61b8c02bc6">txdb</a>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            txdb = pdb = NULL;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <span class="keyword">delete</span> activeBatch;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            activeBatch = NULL;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <a class="code" href="txdb-leveldb_8cpp.html#a9a8c309c31bb9f6feadef44982002926">init_blockindex</a>(options, <span class="keyword">true</span>); <span class="comment">// Remove directory and create new database</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            pdb = <a class="code" href="txdb-leveldb_8cpp.html#a72eff8ae1d84de13daf97a61b8c02bc6">txdb</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordtype">bool</span> fTmp = fReadOnly;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            fReadOnly = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            WriteVersion(DATABASE_VERSION); <span class="comment">// Save transaction index version</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            fReadOnly = fTmp;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fCreate)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordtype">bool</span> fTmp = fReadOnly;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        fReadOnly = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        WriteVersion(DATABASE_VERSION);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        fReadOnly = fTmp;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Opened LevelDB successfully\n&quot;</span>);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#ad319e9c15a7a03b9b80d7affb7fb655e">  123</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_tx_d_b.html#ad319e9c15a7a03b9b80d7affb7fb655e">CTxDB::Close</a>()</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keyword">delete</span> <a class="code" href="txdb-leveldb_8cpp.html#a72eff8ae1d84de13daf97a61b8c02bc6">txdb</a>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    txdb = pdb = NULL;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keyword">delete</span> options.filter_policy;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    options.filter_policy = NULL;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keyword">delete</span> options.block_cache;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    options.block_cache = NULL;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keyword">delete</span> activeBatch;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    activeBatch = NULL;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#af3c27c5cb8f922b5c03840feda844016">  135</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#af3c27c5cb8f922b5c03840feda844016">CTxDB::TxnBegin</a>()</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    assert(!activeBatch);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    activeBatch = <span class="keyword">new</span> <a class="code" href="classleveldb_1_1_write_batch.html">leveldb::WriteBatch</a>();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#aff04f078df2fc3640d559ce62fc9a6a2">  142</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#aff04f078df2fc3640d559ce62fc9a6a2">CTxDB::TxnCommit</a>()</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;{</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    assert(activeBatch);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="classleveldb_1_1_status.html">leveldb::Status</a> status = pdb-&gt;Write(<a class="code" href="structleveldb_1_1_write_options.html">leveldb::WriteOptions</a>(), activeBatch);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keyword">delete</span> activeBatch;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    activeBatch = NULL;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">if</span> (!status.<a class="code" href="classleveldb_1_1_status.html#ab31e89a858c766716e3dc952be857c65">ok</a>()) {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LevelDB batch commit failure: %s\n&quot;</span>, status.<a class="code" href="classleveldb_1_1_status.html#aa8b56d8fe2cd1873778de5d1e5407866">ToString</a>().c_str());</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="class_c_batch_scanner.html">  155</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_c_batch_scanner.html">CBatchScanner</a> : <span class="keyword">public</span> <a class="code" href="classleveldb_1_1_write_batch_1_1_handler.html">leveldb::WriteBatch::Handler</a> {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="class_c_batch_scanner.html#ae04f7151c91676f9f6209737cdc3d086">  157</a></span>&#160;    std::string <a class="code" href="class_c_batch_scanner.html#ae04f7151c91676f9f6209737cdc3d086">needle</a>;</div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="class_c_batch_scanner.html#afdb6e59a53fed441090c43750c3c2617">  158</a></span>&#160;    <span class="keywordtype">bool</span> *<a class="code" href="class_c_batch_scanner.html#afdb6e59a53fed441090c43750c3c2617">deleted</a>;</div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="class_c_batch_scanner.html#a3a82f2f7068f469eb535435a0b9ae640">  159</a></span>&#160;    std::string *<a class="code" href="class_c_batch_scanner.html#a3a82f2f7068f469eb535435a0b9ae640">foundValue</a>;</div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="class_c_batch_scanner.html#ad2669c1d3fbd8c206b1f42348dde8cf0">  160</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_c_batch_scanner.html#ad2669c1d3fbd8c206b1f42348dde8cf0">foundEntry</a>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="class_c_batch_scanner.html#adca0bf13e3c7eb3f70cf324da1901a4a">  162</a></span>&#160;    <a class="code" href="class_c_batch_scanner.html#adca0bf13e3c7eb3f70cf324da1901a4a">CBatchScanner</a>() : foundEntry(false) {}</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="class_c_batch_scanner.html#ae993b8af4417559238d9d985975f9f09">  164</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_c_batch_scanner.html#ae993b8af4417559238d9d985975f9f09">Put</a>(<span class="keyword">const</span> <a class="code" href="classleveldb_1_1_slice.html">leveldb::Slice</a>&amp; key, <span class="keyword">const</span> <a class="code" href="classleveldb_1_1_slice.html">leveldb::Slice</a>&amp; <a class="code" href="version__set_8cc.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>) {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">if</span> (key.<a class="code" href="classleveldb_1_1_slice.html#a2cdd9fb649105033fde510afc9416732">ToString</a>() == needle) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            foundEntry = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            *deleted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            *foundValue = value.<a class="code" href="classleveldb_1_1_slice.html#a2cdd9fb649105033fde510afc9416732">ToString</a>();</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="class_c_batch_scanner.html#a5569f5c1c04cbdaa1e226895d9cdb51a">  172</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_c_batch_scanner.html#a5569f5c1c04cbdaa1e226895d9cdb51a">Delete</a>(<span class="keyword">const</span> <a class="code" href="classleveldb_1_1_slice.html">leveldb::Slice</a>&amp; key) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">if</span> (key.<a class="code" href="classleveldb_1_1_slice.html#a2cdd9fb649105033fde510afc9416732">ToString</a>() == needle) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            foundEntry = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            *deleted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;};</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">// When performing a read, if we have an active batch we need to check it first</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">// before reading from the database, as the rest of the code assumes that once</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">// a database transaction begins reads are consistent with it. It would be good</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">// to change that assumption in future and avoid the performance hit, though in</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">// practice it does not appear to be large.</span></div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a8c718f82f43d567b5bf7487b5d6685e5">  185</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a8c718f82f43d567b5bf7487b5d6685e5">CTxDB::ScanBatch</a>(<span class="keyword">const</span> <a class="code" href="class_c_data_stream.html">CDataStream</a> &amp;key, <span class="keywordtype">string</span> *<a class="code" href="version__set_8cc.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>, <span class="keywordtype">bool</span> *deleted)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    assert(activeBatch);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    *deleted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="class_c_batch_scanner.html">CBatchScanner</a> scanner;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    scanner.<a class="code" href="class_c_batch_scanner.html#ae04f7151c91676f9f6209737cdc3d086">needle</a> = key.<a class="code" href="class_c_data_stream.html#aa3a9ecf166f36f4ea531d2b23628d2c9">str</a>();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    scanner.<a class="code" href="class_c_batch_scanner.html#afdb6e59a53fed441090c43750c3c2617">deleted</a> = deleted;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    scanner.<a class="code" href="class_c_batch_scanner.html#a3a82f2f7068f469eb535435a0b9ae640">foundValue</a> = <a class="code" href="version__set_8cc.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="classleveldb_1_1_status.html">leveldb::Status</a> status = activeBatch-&gt;Iterate(&amp;scanner);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (!status.<a class="code" href="classleveldb_1_1_status.html#ab31e89a858c766716e3dc952be857c65">ok</a>()) {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">throw</span> runtime_error(status.<a class="code" href="classleveldb_1_1_status.html#aa8b56d8fe2cd1873778de5d1e5407866">ToString</a>());</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">return</span> scanner.<a class="code" href="class_c_batch_scanner.html#ad2669c1d3fbd8c206b1f42348dde8cf0">foundEntry</a>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a8a138e5dcc3ef98991abaa16eaa8ddeb">  199</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a8a138e5dcc3ef98991abaa16eaa8ddeb">CTxDB::ReadTxIndex</a>(<a class="code" href="classuint256.html">uint256</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>, <a class="code" href="class_c_tx_index.html">CTxIndex</a>&amp; txindex)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;{</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    txindex.SetNull();</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">return</span> Read(make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;tx&quot;</span>), hash), txindex);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a62fb371022854dc8cb247bed36302df2">  205</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a62fb371022854dc8cb247bed36302df2">CTxDB::UpdateTxIndex</a>(<a class="code" href="classuint256.html">uint256</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>, <span class="keyword">const</span> <a class="code" href="class_c_tx_index.html">CTxIndex</a>&amp; txindex)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;{</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">return</span> Write(make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;tx&quot;</span>), hash), txindex);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a6c0d7c688e8fd7ac28afde78ae6b624e">  210</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a6c0d7c688e8fd7ac28afde78ae6b624e">CTxDB::AddTxIndex</a>(<span class="keyword">const</span> <a class="code" href="class_c_transaction.html">CTransaction</a>&amp; tx, <span class="keyword">const</span> <a class="code" href="class_c_disk_tx_pos.html">CDiskTxPos</a>&amp; pos, <span class="keywordtype">int</span> nHeight)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;{</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// Add to tx index</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="classuint256.html">uint256</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a> = tx.<a class="code" href="class_c_transaction.html#a3f8666d2a275c40da14bd5eaf47dc004">GetHash</a>();</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="class_c_tx_index.html">CTxIndex</a> txindex(pos, tx.<a class="code" href="class_c_transaction.html#ae42c0032a464c3054c508017c7d040ef">vout</a>.size());</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">return</span> Write(make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;tx&quot;</span>), hash), txindex);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a5e0f0ed39529758a90953a2a08fc9412">  218</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a5e0f0ed39529758a90953a2a08fc9412">CTxDB::EraseTxIndex</a>(<span class="keyword">const</span> <a class="code" href="class_c_transaction.html">CTransaction</a>&amp; tx)</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;{</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="classuint256.html">uint256</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a> = tx.<a class="code" href="class_c_transaction.html#a3f8666d2a275c40da14bd5eaf47dc004">GetHash</a>();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">return</span> Erase(make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;tx&quot;</span>), hash));</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a09b87317101ed16b6ad99794279f4c2d">  225</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a09b87317101ed16b6ad99794279f4c2d">CTxDB::ContainsTx</a>(<a class="code" href="classuint256.html">uint256</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;{</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">return</span> Exists(make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;tx&quot;</span>), hash));</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;}</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">bool CTxDB::ReadTxBackIndex(uint256 hash, CTxIndex&amp; txindex)</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">    txindex.SetNull();</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">    return Read(make_pair(string(&quot;txback&quot;), hash), txindex);</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">bool CTxDB::UpdateTxBackIndex(uint256 hash, const CTxIndex&amp; txindex)</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">    return Write(make_pair(string(&quot;txback&quot;), hash), txindex);</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">bool CTxDB::AddTxBackIndex(const CTransaction&amp; tx, const CDiskTxPos&amp; pos, int nHeight)</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">    // Add to tx index</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">    uint256 hash = tx.GetHash();</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">    CTxIndex txindex(pos, tx.vout.size());</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">    return Write(make_pair(string(&quot;txback&quot;), hash), txindex);</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">bool CTxDB::EraseTxBackIndex(const CTransaction&amp; tx)</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">    uint256 hash = tx.GetHash();</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">    return Erase(make_pair(string(&quot;txback&quot;), hash));</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">bool CTxDB::ContainsTxBack(uint256 hash)</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">    return Exists(make_pair(string(&quot;txback&quot;), hash));</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00261"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a32d0e546eee99724776352dd4bf0ae79">  261</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a32d0e546eee99724776352dd4bf0ae79">CTxDB::ReadDiskTx</a>(<a class="code" href="classuint256.html">uint256</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>, <a class="code" href="class_c_transaction.html">CTransaction</a>&amp; tx, <a class="code" href="class_c_tx_index.html">CTxIndex</a>&amp; txindex)</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;{</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    tx.SetNull();</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">if</span> (!ReadTxIndex(hash, txindex))</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">return</span> (tx.<a class="code" href="class_c_transaction.html#ad9d526afecbd816c385343f60c5352fd">ReadFromDisk</a>(txindex.<a class="code" href="class_c_tx_index.html#ac68a69ed4335b3f50b954c71ec0a9c32">pos</a>));</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#ab32f32729feabef7162d5fa225dd0e22">  269</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a32d0e546eee99724776352dd4bf0ae79">CTxDB::ReadDiskTx</a>(<a class="code" href="classuint256.html">uint256</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>, <a class="code" href="class_c_transaction.html">CTransaction</a>&amp; tx)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;{</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <a class="code" href="class_c_tx_index.html">CTxIndex</a> txindex;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">return</span> ReadDiskTx(hash, tx, txindex);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a80ee65f82bb1a769b507dc5c701bfacc">  275</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a32d0e546eee99724776352dd4bf0ae79">CTxDB::ReadDiskTx</a>(<a class="code" href="class_c_out_point.html">COutPoint</a> outpoint, <a class="code" href="class_c_transaction.html">CTransaction</a>&amp; tx, <a class="code" href="class_c_tx_index.html">CTxIndex</a>&amp; txindex)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;{</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">return</span> ReadDiskTx(outpoint.<a class="code" href="class_c_out_point.html#af131c7194a660558b0ff158f4efa7a28">hash</a>, tx, txindex);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;}</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a4d7f67f600359473ddd2044030323215">  280</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a32d0e546eee99724776352dd4bf0ae79">CTxDB::ReadDiskTx</a>(<a class="code" href="class_c_out_point.html">COutPoint</a> outpoint, <a class="code" href="class_c_transaction.html">CTransaction</a>&amp; tx)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;{</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <a class="code" href="class_c_tx_index.html">CTxIndex</a> txindex;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">return</span> ReadDiskTx(outpoint.<a class="code" href="class_c_out_point.html#af131c7194a660558b0ff158f4efa7a28">hash</a>, tx, txindex);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">bool CTxDB::ReadDiskTxBack(uint256 hash, CTransaction&amp; tx, CTxIndex&amp; txindex)</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">    tx.SetNull();</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">    if (!ReadTxBackIndex(hash, txindex))</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">    return (tx.ReadFromDisk(txindex.pos));</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">bool CTxDB::ReadDiskTxBack(uint256 hash, CTransaction&amp; tx)</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">    CTxIndex txindex;</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">    return ReadDiskTxBack(hash, tx, txindex);</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">bool CTxDB::ReadDiskTxBack(COutPoint outpoint, CTransaction&amp; tx, CTxIndex&amp; txindex)</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">    return ReadDiskTxBack(outpoint.hash, tx, txindex);</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">bool CTxDB::ReadDiskTxBack(COutPoint outpoint, CTransaction&amp; tx)</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">    CTxIndex txindex;</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">    return ReadDiskTxBack(outpoint.hash, tx, txindex);</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a56f170187a609bd747c29b3a4adddd8e">  311</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a56f170187a609bd747c29b3a4adddd8e">CTxDB::WriteBlockIndex</a>(<span class="keyword">const</span> <a class="code" href="class_c_disk_block_index.html">CDiskBlockIndex</a>&amp; blockindex)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;{</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">return</span> Write(make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;blockindex&quot;</span>), blockindex.<a class="code" href="class_c_block_index.html#ab843ef9b8b0a0193ec3a5c24738e484f">GetBlockHash</a>()), blockindex);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a9aae38d6e39ce57a1b8eaaeaea81e4de">  316</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a9aae38d6e39ce57a1b8eaaeaea81e4de">CTxDB::ReadHashBestChain</a>(<a class="code" href="classuint256.html">uint256</a>&amp; <a class="code" href="main_8cpp.html#ace9c3343567f488a96598abe61e1d309">hashBestChain</a>)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;{</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">return</span> Read(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;hashBestChain&quot;</span>), hashBestChain);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a2cf58de69c1c07e500a1f8d0b0709476">  321</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a2cf58de69c1c07e500a1f8d0b0709476">CTxDB::WriteHashBestChain</a>(<a class="code" href="classuint256.html">uint256</a> <a class="code" href="main_8cpp.html#ace9c3343567f488a96598abe61e1d309">hashBestChain</a>)</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;{</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">return</span> Write(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;hashBestChain&quot;</span>), hashBestChain);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#ab0e2e8f95c4f891c0a9245d5ba6b0b68">  326</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#ab0e2e8f95c4f891c0a9245d5ba6b0b68">CTxDB::ReadBestInvalidTrust</a>(<a class="code" href="class_c_big_num.html">CBigNum</a>&amp; bnBestInvalidTrust)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;{</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">return</span> Read(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;bnBestInvalidTrust&quot;</span>), bnBestInvalidTrust);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div>
<div class="line"><a name="l00331"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#ad9593efae66f6a73fafba93ad05fd2b8">  331</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#ad9593efae66f6a73fafba93ad05fd2b8">CTxDB::WriteBestInvalidTrust</a>(<a class="code" href="class_c_big_num.html">CBigNum</a> bnBestInvalidTrust)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;{</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">return</span> Write(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;bnBestInvalidTrust&quot;</span>), bnBestInvalidTrust);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;}</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a85576980e059ee1471fe6ae2ae8f1b59">  336</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a85576980e059ee1471fe6ae2ae8f1b59">CTxDB::ReadSyncCheckpoint</a>(<a class="code" href="classuint256.html">uint256</a>&amp; hashCheckpoint)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;{</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">return</span> Read(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;hashSyncCheckpoint&quot;</span>), hashCheckpoint);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#a6fed172063f2ec1f4688ac3f21b0608a">  341</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#a6fed172063f2ec1f4688ac3f21b0608a">CTxDB::WriteSyncCheckpoint</a>(<a class="code" href="classuint256.html">uint256</a> hashCheckpoint)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;{</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">return</span> Write(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;hashSyncCheckpoint&quot;</span>), hashCheckpoint);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;}</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#ab05fe91e649658eebe0a05227fde3059">  346</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#ab05fe91e649658eebe0a05227fde3059">CTxDB::ReadCheckpointPubKey</a>(<span class="keywordtype">string</span>&amp; strPubKey)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;{</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">return</span> Read(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;strCheckpointPubKey&quot;</span>), strPubKey);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;}</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#ab417d5e3a281ae192658dcac6f4a39a9">  351</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#ab417d5e3a281ae192658dcac6f4a39a9">CTxDB::WriteCheckpointPubKey</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; strPubKey)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;{</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">return</span> Write(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;strCheckpointPubKey&quot;</span>), strPubKey);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="keyword">static</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *InsertBlockIndex(<a class="code" href="classuint256.html">uint256</a> <a class="code" href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a>)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;{</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">if</span> (hash == 0)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// Return existing</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    map&lt;uint256, CBlockIndex*&gt;::iterator mi = <a class="code" href="main_8cpp.html#a7ed5e264d5cdb0fdcf0fa6ae68ee4638">mapBlockIndex</a>.find(hash);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span> (mi != <a class="code" href="main_8cpp.html#a7ed5e264d5cdb0fdcf0fa6ae68ee4638">mapBlockIndex</a>.end())</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordflow">return</span> (*mi).second;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">// Create new</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindexNew = <span class="keyword">new</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a>();</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">if</span> (!pindexNew)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;LoadBlockIndex() : new CBlockIndex failed&quot;</span>);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    mi = <a class="code" href="main_8cpp.html#a7ed5e264d5cdb0fdcf0fa6ae68ee4638">mapBlockIndex</a>.insert(make_pair(hash, pindexNew)).first;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    pindexNew-&gt;phashBlock = &amp;((*mi).first);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">return</span> pindexNew;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;}</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno"><a class="line" href="class_c_tx_d_b.html#abcb9df0821d996f811f6604b452a26a0">  376</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_tx_d_b.html#abcb9df0821d996f811f6604b452a26a0">CTxDB::LoadBlockIndex</a>()</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;{</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="main_8cpp.html#a7ed5e264d5cdb0fdcf0fa6ae68ee4638">mapBlockIndex</a>.size() &gt; 0) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="comment">// Already loaded once in this session. It can happen during migration</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="comment">// from BDB.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">// The block index is an in-memory structure that maps hashes to on-disk</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">// locations where the contents of the block can be found. Here, we scan it</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">// out of the DB and into mapBlockIndex.</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <a class="code" href="classleveldb_1_1_iterator.html">leveldb::Iterator</a> *iterator = pdb-&gt;NewIterator(<a class="code" href="structleveldb_1_1_read_options.html">leveldb::ReadOptions</a>());</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">// Seek to start key.</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="class_c_data_stream.html">CDataStream</a> ssStartKey(<a class="code" href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a>, CLIENT_VERSION);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    ssStartKey &lt;&lt; make_pair(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;blockindex&quot;</span>), <a class="code" href="classuint256.html">uint256</a>(0));</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    iterator-&gt;<a class="code" href="classleveldb_1_1_iterator.html#a97a556e97ded60c677fbf4de7321ec44">Seek</a>(ssStartKey.<a class="code" href="class_c_data_stream.html#aa3a9ecf166f36f4ea531d2b23628d2c9">str</a>());</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">// Now read each entry.</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">while</span> (iterator-&gt;<a class="code" href="classleveldb_1_1_iterator.html#a38614978bfa0586327b8e237bcb46012">Valid</a>())</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="comment">// Unpack keys and values.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <a class="code" href="class_c_data_stream.html">CDataStream</a> ssKey(<a class="code" href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a>, CLIENT_VERSION);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        ssKey.<a class="code" href="class_c_data_stream.html#a878b5fa69636a1f092d0b877dfdd31fc">write</a>(iterator-&gt;<a class="code" href="classleveldb_1_1_iterator.html#ad17feced6e24a1b21db5ae6940c1f220">key</a>().<a class="code" href="classleveldb_1_1_slice.html#aa64861043d9deee6889461bf0593cf73">data</a>(), iterator-&gt;<a class="code" href="classleveldb_1_1_iterator.html#ad17feced6e24a1b21db5ae6940c1f220">key</a>().<a class="code" href="classleveldb_1_1_slice.html#a947d3173f04f8a30553e89046daf91d5">size</a>());</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <a class="code" href="class_c_data_stream.html">CDataStream</a> ssValue(<a class="code" href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a>, CLIENT_VERSION);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        ssValue.<a class="code" href="class_c_data_stream.html#a878b5fa69636a1f092d0b877dfdd31fc">write</a>(iterator-&gt;<a class="code" href="classleveldb_1_1_iterator.html#a613ac2e965518aad7a064c64c72bcf7c">value</a>().<a class="code" href="classleveldb_1_1_slice.html#aa64861043d9deee6889461bf0593cf73">data</a>(), iterator-&gt;<a class="code" href="classleveldb_1_1_iterator.html#a613ac2e965518aad7a064c64c72bcf7c">value</a>().<a class="code" href="classleveldb_1_1_slice.html#a947d3173f04f8a30553e89046daf91d5">size</a>());</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordtype">string</span> strType;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        ssKey &gt;&gt; strType;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="comment">// Did we reach the end of the data to read?</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#a5dda805bdc19ceffaf26ddd2056ccc0a">fRequestShutdown</a> || strType != <span class="stringliteral">&quot;blockindex&quot;</span>)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <a class="code" href="class_c_disk_block_index.html">CDiskBlockIndex</a> diskindex;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        ssValue &gt;&gt; diskindex;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <a class="code" href="classuint256.html">uint256</a> blockHash = diskindex.GetBlockHash();</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="comment">// Construct block index object</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindexNew    = InsertBlockIndex(blockHash);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>          = InsertBlockIndex(diskindex.hashPrev);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a2f0acd342accaab731d887584b444590">pnext</a>          = InsertBlockIndex(diskindex.hashNext);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a3bf9ecd8938c42be6a4b14d3c7ef5c21">nFile</a>          = diskindex.nFile;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#af8de5426e2da2c78e1e7729a89a7670a">nBlockPos</a>      = diskindex.nBlockPos;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>        = diskindex.nHeight;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a6559fddea3401548ae144e870d150359">nMint</a>          = diskindex.nMint;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a309fdc44d871b336abe64eadf250cafd">nMoneySupply</a>   = diskindex.nMoneySupply;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a02aaba7d27ec615e6f9f740353d839de">nFlags</a>         = diskindex.nFlags;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a2aa226c04d79a4d932ed6eb0abd02cbe">nStakeModifier</a> = diskindex.nStakeModifier;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#ac2c040d5e3db73a5ceb87ee4095a405f">prevoutStake</a>   = diskindex.prevoutStake;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#ae6870336a5bf237680502fa067262af8">nStakeTime</a>     = diskindex.nStakeTime;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a553e6fc301e8130118d7ec68dce91ee9">hashProof</a>      = diskindex.hashProof;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a45126301a0a6e26010527a7bbfc1ef58">nVersion</a>       = diskindex.nVersion;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a0601b6b2bd6eaedfbc283c00d045a21c">hashMerkleRoot</a> = diskindex.hashMerkleRoot;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a4b687a226e9e166b0f91c1b616b543a6">nTime</a>          = diskindex.nTime;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a3324894e6af612d1bd76f89378435713">nBits</a>          = diskindex.nBits;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        pindexNew-&gt;<a class="code" href="class_c_block_index.html#a5e0a648ed1df8da171eba636d5ebef01">nNonce</a>         = diskindex.nNonce;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="comment">// Watch for genesis block</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="main_8cpp.html#a1e7c54b8b26730f52b5527163fc33d8f">pindexGenesisBlock</a> == NULL &amp;&amp; blockHash == (!<a class="code" href="protocol_8h.html#add584db8359330a002dc0d5c4decdb07">fTestNet</a> ? hashGenesisBlock : hashGenesisBlockTestNet))</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <a class="code" href="main_8cpp.html#a1e7c54b8b26730f52b5527163fc33d8f">pindexGenesisBlock</a> = pindexNew;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">if</span> (!pindexNew-&gt;<a class="code" href="class_c_block_index.html#a32c6c256b6e30b4a20dc6faa9cac7ea5">CheckIndex</a>()) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <span class="keyword">delete</span> iterator;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="util_8cpp.html#a94053a19aa8c78ceb2da4c19a1a2fc23">error</a>(<span class="stringliteral">&quot;LoadBlockIndex() : CheckIndex failed at %d&quot;</span>, pindexNew-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="comment">// NovaCoin: build setStakeSeen</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">if</span> (pindexNew-&gt;<a class="code" href="class_c_block_index.html#ace1a0acbedc0403489e4d9168876fb23">IsProofOfStake</a>())</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <a class="code" href="main_8cpp.html#a76784ec097b3e97b81272c0858d623e4">setStakeSeen</a>.insert(make_pair(pindexNew-&gt;<a class="code" href="class_c_block_index.html#ac2c040d5e3db73a5ceb87ee4095a405f">prevoutStake</a>, pindexNew-&gt;<a class="code" href="class_c_block_index.html#ae6870336a5bf237680502fa067262af8">nStakeTime</a>));</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        iterator-&gt;<a class="code" href="classleveldb_1_1_iterator.html#aea54a5ca7eb942eb15770820529410e7">Next</a>();</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keyword">delete</span> iterator;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#a5dda805bdc19ceffaf26ddd2056ccc0a">fRequestShutdown</a>)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">// Calculate nChainTrust</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    vector&lt;pair&lt;int, CBlockIndex*&gt; &gt; vSortedByHeight;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    vSortedByHeight.reserve(<a class="code" href="main_8cpp.html#a7ed5e264d5cdb0fdcf0fa6ae68ee4638">mapBlockIndex</a>.size());</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="util_8h.html#aa3052ab82a2ba880ea3e30b3357c8820">PAIRTYPE</a>(<a class="code" href="classuint256.html">uint256</a>, <a class="code" href="class_c_block_index.html">CBlockIndex</a>*)&amp; item, <a class="code" href="main_8cpp.html#a7ed5e264d5cdb0fdcf0fa6ae68ee4638">mapBlockIndex</a>)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindex = item.second;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        vSortedByHeight.push_back(make_pair(pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, pindex));</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    sort(vSortedByHeight.begin(), vSortedByHeight.end());</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="util_8h.html#aa3052ab82a2ba880ea3e30b3357c8820">PAIRTYPE</a>(<span class="keywordtype">int</span>, <a class="code" href="class_c_block_index.html">CBlockIndex</a>*)&amp; item, vSortedByHeight)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindex = item.second;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        pindex-&gt;<a class="code" href="class_c_block_index.html#aa11268e5a01c5a7d33fb313fb0494015">nChainTrust</a> = (pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a> ? pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>-&gt;<a class="code" href="class_c_block_index.html#aa11268e5a01c5a7d33fb313fb0494015">nChainTrust</a> : 0) + pindex-&gt;<a class="code" href="class_c_block_index.html#ab8cb2abace4e5b6dd405e85f66f17f9a">GetBlockTrust</a>();</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="comment">// NovaCoin: calculate stake modifier checksum</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        pindex-&gt;<a class="code" href="class_c_block_index.html#ad29fd7c96d1e350aa39c61a2afcfdb26">nStakeModifierChecksum</a> = <a class="code" href="kernel_8cpp.html#abe84e84f5454fc09dca2044396daf59d">GetStakeModifierChecksum</a>(pindex);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="kernel_8cpp.html#ace6da0cc4405eedd50d7a15d9f3e4f74">CheckStakeModifierCheckpoints</a>(pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, pindex-&gt;<a class="code" href="class_c_block_index.html#ad29fd7c96d1e350aa39c61a2afcfdb26">nStakeModifierChecksum</a>))</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="util_8cpp.html#a94053a19aa8c78ceb2da4c19a1a2fc23">error</a>(<span class="stringliteral">&quot;CTxDB::LoadBlockIndex() : Failed stake modifier checkpoint height=%d, modifier=0x%016&quot;</span>PRIx64, pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, pindex-&gt;<a class="code" href="class_c_block_index.html#a2aa226c04d79a4d932ed6eb0abd02cbe">nStakeModifier</a>);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// Load hashBestChain pointer to end of best chain</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span> (!ReadHashBestChain(<a class="code" href="main_8cpp.html#ace9c3343567f488a96598abe61e1d309">hashBestChain</a>))</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="main_8cpp.html#a1e7c54b8b26730f52b5527163fc33d8f">pindexGenesisBlock</a> == NULL)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="util_8cpp.html#a94053a19aa8c78ceb2da4c19a1a2fc23">error</a>(<span class="stringliteral">&quot;CTxDB::LoadBlockIndex() : hashBestChain not loaded&quot;</span>);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="main_8cpp.html#a7ed5e264d5cdb0fdcf0fa6ae68ee4638">mapBlockIndex</a>.count(<a class="code" href="main_8cpp.html#ace9c3343567f488a96598abe61e1d309">hashBestChain</a>))</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="util_8cpp.html#a94053a19aa8c78ceb2da4c19a1a2fc23">error</a>(<span class="stringliteral">&quot;CTxDB::LoadBlockIndex() : hashBestChain not found in the block index&quot;</span>);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <a class="code" href="main_8cpp.html#a6454ad864029344132a0a0b59b1456ee">pindexBest</a> = <a class="code" href="main_8cpp.html#a7ed5e264d5cdb0fdcf0fa6ae68ee4638">mapBlockIndex</a>[<a class="code" href="main_8cpp.html#ace9c3343567f488a96598abe61e1d309">hashBestChain</a>];</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="main_8cpp.html#a843f1984796a7e44a9e23fccd6a8af34">nBestHeight</a> = <a class="code" href="main_8cpp.html#a6454ad864029344132a0a0b59b1456ee">pindexBest</a>-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="main_8cpp.html#a63af124faf22e03fd629e8aa21c40eae">nBestChainTrust</a> = <a class="code" href="main_8cpp.html#a6454ad864029344132a0a0b59b1456ee">pindexBest</a>-&gt;<a class="code" href="class_c_block_index.html#aa11268e5a01c5a7d33fb313fb0494015">nChainTrust</a>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex(): hashBestChain=%s  height=%d  trust=%s  date=%s\n&quot;</span>,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <a class="code" href="main_8cpp.html#ace9c3343567f488a96598abe61e1d309">hashBestChain</a>.<a class="code" href="classbase__uint.html#ac3080a72402cadf28dbc9f9b69cc60be">ToString</a>().substr(0,20).c_str(), <a class="code" href="main_8cpp.html#a843f1984796a7e44a9e23fccd6a8af34">nBestHeight</a>, <a class="code" href="class_c_big_num.html">CBigNum</a>(<a class="code" href="main_8cpp.html#a63af124faf22e03fd629e8aa21c40eae">nBestChainTrust</a>).<a class="code" href="class_c_big_num.html#adca0fa61568497152375328deef6c895">ToString</a>().c_str(),</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <a class="code" href="util_8h.html#a749bc6776c8ec72d7c5e4dea56aee415">DateTimeStrFormat</a>(<span class="stringliteral">&quot;%x %H:%M:%S&quot;</span>, <a class="code" href="main_8cpp.html#a6454ad864029344132a0a0b59b1456ee">pindexBest</a>-&gt;<a class="code" href="class_c_block_index.html#ab63b774ae798f5f9e54b400ac8b5ef4b">GetBlockTime</a>()).c_str());</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">// NovaCoin: load hashSyncCheckpoint</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">if</span> (!ReadSyncCheckpoint(<a class="code" href="namespace_checkpoints.html#ae6bf7381439fe6995194c0b636bd6f37">Checkpoints::hashSyncCheckpoint</a>))</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="util_8cpp.html#a94053a19aa8c78ceb2da4c19a1a2fc23">error</a>(<span class="stringliteral">&quot;CTxDB::LoadBlockIndex() : hashSyncCheckpoint not loaded&quot;</span>);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex(): synchronized checkpoint %s\n&quot;</span>, <a class="code" href="namespace_checkpoints.html#ae6bf7381439fe6995194c0b636bd6f37">Checkpoints::hashSyncCheckpoint</a>.ToString().c_str());</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="comment">// Load bnBestInvalidTrust, OK if it doesn&#39;t exist</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <a class="code" href="class_c_big_num.html">CBigNum</a> bnBestInvalidTrust;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    ReadBestInvalidTrust(bnBestInvalidTrust);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <a class="code" href="main_8cpp.html#a27c4c119ca2e7250221de8c17bee0999">nBestInvalidTrust</a> = bnBestInvalidTrust.<a class="code" href="class_c_big_num.html#ad17ff84ee557ca5ad4b854e14d08099f">getuint256</a>();</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// Verify blocks in the best chain</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordtype">int</span> nCheckLevel = <a class="code" href="util_8cpp.html#a24f685720bf40370e5bd2a192ad50cd8">GetArg</a>(<span class="stringliteral">&quot;-checklevel&quot;</span>, 1);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordtype">int</span> nCheckDepth = <a class="code" href="util_8cpp.html#a24f685720bf40370e5bd2a192ad50cd8">GetArg</a>( <span class="stringliteral">&quot;-checkblocks&quot;</span>, 2500);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">if</span> (nCheckDepth == 0)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        nCheckDepth = 1000000000; <span class="comment">// suffices until the year 19000</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">if</span> (nCheckDepth &gt; <a class="code" href="main_8cpp.html#a843f1984796a7e44a9e23fccd6a8af34">nBestHeight</a>)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        nCheckDepth = <a class="code" href="main_8cpp.html#a843f1984796a7e44a9e23fccd6a8af34">nBestHeight</a>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;Verifying last %i blocks at level %i\n&quot;</span>, nCheckDepth, nCheckLevel);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindexFork = NULL;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    map&lt;pair&lt;unsigned int, unsigned int&gt;, <a class="code" href="class_c_block_index.html">CBlockIndex</a>*&gt; mapBlockPos;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindex = <a class="code" href="main_8cpp.html#a6454ad864029344132a0a0b59b1456ee">pindexBest</a>; pindex &amp;&amp; pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>; pindex = pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>)</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#a5dda805bdc19ceffaf26ddd2056ccc0a">fRequestShutdown</a> || pindex-&gt;nHeight &lt; <a class="code" href="main_8cpp.html#a843f1984796a7e44a9e23fccd6a8af34">nBestHeight</a>-nCheckDepth)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <a class="code" href="class_c_block.html">CBlock</a> block;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">if</span> (!block.<a class="code" href="class_c_block.html#a77a1b1e9902e1e557d762f5a5f325cd8">ReadFromDisk</a>(pindex))</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="util_8cpp.html#a94053a19aa8c78ceb2da4c19a1a2fc23">error</a>(<span class="stringliteral">&quot;LoadBlockIndex() : block.ReadFromDisk failed&quot;</span>);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="comment">// check level 1: verify block validity</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="comment">// check level 7: verify block signature too</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">if</span> (nCheckLevel&gt;0 &amp;&amp; !block.<a class="code" href="class_c_block.html#a94aa40aa679d7d530bd391e1fe7eb330">CheckBlock</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, (nCheckLevel&gt;6)))</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex() : *** found bad block at %d, hash=%s\n&quot;</span>, pindex-&gt;nHeight, pindex-&gt;GetBlockHash().ToString().c_str());</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            pindexFork = pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="comment">// check level 2: verify transaction index validity</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordflow">if</span> (nCheckLevel&gt;1)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            pair&lt;unsigned int, unsigned int&gt; pos = make_pair(pindex-&gt;nFile, pindex-&gt;nBlockPos);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            mapBlockPos[pos] = pindex;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_transaction.html">CTransaction</a> &amp;tx, block.<a class="code" href="class_c_block.html#a9b6508d662722775f3029b980b382b66">vtx</a>)</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                <a class="code" href="classuint256.html">uint256</a> hashTx = tx.<a class="code" href="class_c_transaction.html#a3f8666d2a275c40da14bd5eaf47dc004">GetHash</a>();</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                <a class="code" href="class_c_tx_index.html">CTxIndex</a> txindex;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                <span class="keywordflow">if</span> (ReadTxIndex(hashTx, txindex))</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                    <span class="comment">// check level 3: checker transaction hashes</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                    <span class="keywordflow">if</span> (nCheckLevel&gt;2 || pindex-&gt;nFile != txindex.<a class="code" href="class_c_tx_index.html#ac68a69ed4335b3f50b954c71ec0a9c32">pos</a>.<a class="code" href="class_c_disk_tx_pos.html#a07198e7b96d4c60ece4d895abbd46104">nFile</a> || pindex-&gt;nBlockPos != txindex.<a class="code" href="class_c_tx_index.html#ac68a69ed4335b3f50b954c71ec0a9c32">pos</a>.<a class="code" href="class_c_disk_tx_pos.html#ae9b3c262149c035be43010cbf7d1423b">nBlockPos</a>)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                    {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                        <span class="comment">// either an error or a duplicate transaction</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                        <a class="code" href="class_c_transaction.html">CTransaction</a> txFound;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                        <span class="keywordflow">if</span> (!txFound.<a class="code" href="class_c_transaction.html#ad9d526afecbd816c385343f60c5352fd">ReadFromDisk</a>(txindex.<a class="code" href="class_c_tx_index.html#ac68a69ed4335b3f50b954c71ec0a9c32">pos</a>))</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                        {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                            <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex() : *** cannot read mislocated transaction %s\n&quot;</span>, hashTx.<a class="code" href="classbase__uint.html#ac3080a72402cadf28dbc9f9b69cc60be">ToString</a>().c_str());</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                            pindexFork = pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                        }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                            <span class="keywordflow">if</span> (txFound.<a class="code" href="class_c_transaction.html#a3f8666d2a275c40da14bd5eaf47dc004">GetHash</a>() != hashTx) <span class="comment">// not a duplicate tx</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                            {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex(): *** invalid tx position for %s\n&quot;</span>, hashTx.<a class="code" href="classbase__uint.html#ac3080a72402cadf28dbc9f9b69cc60be">ToString</a>().c_str());</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                                pindexFork = pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                            }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                    }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                    <span class="comment">// check level 4: check whether spent txouts were spent within the main chain</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nOutput = 0;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                    <span class="keywordflow">if</span> (nCheckLevel&gt;3)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                    {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                        BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_disk_tx_pos.html">CDiskTxPos</a> &amp;txpos, txindex.<a class="code" href="class_c_tx_index.html#a88317d56c02acd1faec4863bcb293d2c">vSpent</a>)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                        {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                            <span class="keywordflow">if</span> (!txpos.<a class="code" href="class_c_disk_tx_pos.html#ae4bdd4eba8a9712dba1b4216559f11df">IsNull</a>())</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                            {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                                pair&lt;unsigned int, unsigned int&gt; posFind = make_pair(txpos.<a class="code" href="class_c_disk_tx_pos.html#a07198e7b96d4c60ece4d895abbd46104">nFile</a>, txpos.<a class="code" href="class_c_disk_tx_pos.html#ae9b3c262149c035be43010cbf7d1423b">nBlockPos</a>);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                                <span class="keywordflow">if</span> (!mapBlockPos.count(posFind))</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                                {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                                    <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex(): *** found bad spend at %d, hashBlock=%s, hashTx=%s\n&quot;</span>, pindex-&gt;nHeight, pindex-&gt;GetBlockHash().ToString().c_str(), hashTx.<a class="code" href="classbase__uint.html#ac3080a72402cadf28dbc9f9b69cc60be">ToString</a>().c_str());</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                                    pindexFork = pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                                }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                                <span class="comment">// check level 6: check whether spent txouts were spent by a valid transaction that consume them</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                                <span class="keywordflow">if</span> (nCheckLevel&gt;5)</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                                    <a class="code" href="class_c_transaction.html">CTransaction</a> txSpend;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                                    <span class="keywordflow">if</span> (!txSpend.<a class="code" href="class_c_transaction.html#ad9d526afecbd816c385343f60c5352fd">ReadFromDisk</a>(txpos))</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                                    {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                                        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex(): *** cannot read spending transaction of %s:%i from disk\n&quot;</span>, hashTx.<a class="code" href="classbase__uint.html#ac3080a72402cadf28dbc9f9b69cc60be">ToString</a>().c_str(), nOutput);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                                        pindexFork = pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                    }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!txSpend.<a class="code" href="class_c_transaction.html#ad004cb6fdc2c42ca9e1fabf05a7d0ab3">CheckTransaction</a>())</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                                    {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                                        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex(): *** spending transaction of %s:%i is invalid\n&quot;</span>, hashTx.<a class="code" href="classbase__uint.html#ac3080a72402cadf28dbc9f9b69cc60be">ToString</a>().c_str(), nOutput);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                                        pindexFork = pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                                    }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                                    {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                                        <span class="keywordtype">bool</span> fFound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                                        BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_tx_in.html">CTxIn</a> &amp;txin, txSpend.<a class="code" href="class_c_transaction.html#a53fa787e4ea57374b4fa2a28e9a957b2">vin</a>)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                                            <span class="keywordflow">if</span> (txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>.<a class="code" href="class_c_out_point.html#af131c7194a660558b0ff158f4efa7a28">hash</a> == hashTx &amp;&amp; txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>.<a class="code" href="class_c_out_point.html#a9fbc648ca0d11421ad66e897185a9b58">n</a> == nOutput)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                                                fFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                                        <span class="keywordflow">if</span> (!fFound)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                                        {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                                            <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex(): *** spending transaction of %s:%i does not spend it\n&quot;</span>, hashTx.<a class="code" href="classbase__uint.html#ac3080a72402cadf28dbc9f9b69cc60be">ToString</a>().c_str(), nOutput);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                                            pindexFork = pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                                        }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                                    }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                                }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                            }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                            nOutput++;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                        }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                    }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                <span class="comment">// check level 5: check whether all prevouts are marked spent</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                <span class="keywordflow">if</span> (nCheckLevel&gt;4)</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                     BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_tx_in.html">CTxIn</a> &amp;txin, tx.<a class="code" href="class_c_transaction.html#a53fa787e4ea57374b4fa2a28e9a957b2">vin</a>)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                     {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                          <a class="code" href="class_c_tx_index.html">CTxIndex</a> txindex;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                          <span class="keywordflow">if</span> (ReadTxIndex(txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>.<a class="code" href="class_c_out_point.html#af131c7194a660558b0ff158f4efa7a28">hash</a>, txindex))</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                              <span class="keywordflow">if</span> (txindex.<a class="code" href="class_c_tx_index.html#a88317d56c02acd1faec4863bcb293d2c">vSpent</a>.size()-1 &lt; txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>.<a class="code" href="class_c_out_point.html#a9fbc648ca0d11421ad66e897185a9b58">n</a> || txindex.<a class="code" href="class_c_tx_index.html#a88317d56c02acd1faec4863bcb293d2c">vSpent</a>[txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>.<a class="code" href="class_c_out_point.html#a9fbc648ca0d11421ad66e897185a9b58">n</a>].IsNull())</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                              {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                  <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex(): *** found unspent prevout %s:%i in %s\n&quot;</span>, txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>.<a class="code" href="class_c_out_point.html#af131c7194a660558b0ff158f4efa7a28">hash</a>.<a class="code" href="classbase__uint.html#ac3080a72402cadf28dbc9f9b69cc60be">ToString</a>().c_str(), txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>.<a class="code" href="class_c_out_point.html#a9fbc648ca0d11421ad66e897185a9b58">n</a>, hashTx.<a class="code" href="classbase__uint.html#ac3080a72402cadf28dbc9f9b69cc60be">ToString</a>().c_str());</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                  pindexFork = pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                              }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                     }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">if</span> (pindexFork &amp;&amp; !<a class="code" href="util_8cpp.html#a5dda805bdc19ceffaf26ddd2056ccc0a">fRequestShutdown</a>)</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="comment">// Reorg back to the fork</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <a class="code" href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a>(<span class="stringliteral">&quot;LoadBlockIndex() : *** moving best chain pointer back to block %d\n&quot;</span>, pindexFork-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <a class="code" href="class_c_block.html">CBlock</a> block;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span> (!block.<a class="code" href="class_c_block.html#a77a1b1e9902e1e557d762f5a5f325cd8">ReadFromDisk</a>(pindexFork))</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="util_8cpp.html#a94053a19aa8c78ceb2da4c19a1a2fc23">error</a>(<span class="stringliteral">&quot;LoadBlockIndex() : block.ReadFromDisk failed&quot;</span>);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <a class="code" href="class_c_tx_d_b.html">CTxDB</a> <a class="code" href="txdb-leveldb_8cpp.html#a72eff8ae1d84de13daf97a61b8c02bc6">txdb</a>;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        block.<a class="code" href="class_c_block.html#a6e308b2d75d1cfc4a75eda36feb60ca1">SetBestChain</a>(txdb, pindexFork);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;}</div>
<div class="ttc" id="util_8cpp_html_a94053a19aa8c78ceb2da4c19a1a2fc23"><div class="ttname"><a href="util_8cpp.html#a94053a19aa8c78ceb2da4c19a1a2fc23">error</a></div><div class="ttdeci">bool error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00333">util.cpp:333</a></div></div>
<div class="ttc" id="util_8cpp_html_ab83866a054745d4b30a3948a1b44beba"><div class="ttname"><a href="util_8cpp.html#ab83866a054745d4b30a3948a1b44beba">GetDataDir</a></div><div class="ttdeci">const boost::filesystem::path &amp; GetDataDir(bool fNetSpecific)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l01020">util.cpp:1020</a></div></div>
<div class="ttc" id="class_c_block_index_html_ae6870336a5bf237680502fa067262af8"><div class="ttname"><a href="class_c_block_index.html#ae6870336a5bf237680502fa067262af8">CBlockIndex::nStakeTime</a></div><div class="ttdeci">unsigned int nStakeTime</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01135">main.h:1135</a></div></div>
<div class="ttc" id="class_c_block_html_a94aa40aa679d7d530bd391e1fe7eb330"><div class="ttname"><a href="class_c_block.html#a94aa40aa679d7d530bd391e1fe7eb330">CBlock::CheckBlock</a></div><div class="ttdeci">bool CheckBlock(bool fCheckPOW=true, bool fCheckMerkleRoot=true, bool fCheckSig=true) const </div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l02164">main.cpp:2164</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_ad9593efae66f6a73fafba93ad05fd2b8"><div class="ttname"><a href="class_c_tx_d_b.html#ad9593efae66f6a73fafba93ad05fd2b8">CTxDB::WriteBestInvalidTrust</a></div><div class="ttdeci">bool WriteBestInvalidTrust(CBigNum bnBestInvalidTrust)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00331">txdb-leveldb.cpp:331</a></div></div>
<div class="ttc" id="class_c_batch_scanner_html_afdb6e59a53fed441090c43750c3c2617"><div class="ttname"><a href="class_c_batch_scanner.html#afdb6e59a53fed441090c43750c3c2617">CBatchScanner::deleted</a></div><div class="ttdeci">bool * deleted</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00158">txdb-leveldb.cpp:158</a></div></div>
<div class="ttc" id="class_c_block_index_html_ace1a0acbedc0403489e4d9168876fb23"><div class="ttname"><a href="class_c_block_index.html#ace1a0acbedc0403489e4d9168876fb23">CBlockIndex::IsProofOfStake</a></div><div class="ttdeci">bool IsProofOfStake() const </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01277">main.h:1277</a></div></div>
<div class="ttc" id="util_8h_html_a86c8651322c9dd7ba3abf64c088993be"><div class="ttname"><a href="util_8h.html#a86c8651322c9dd7ba3abf64c088993be">strprintf</a></div><div class="ttdeci">#define strprintf(format,...)</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00161">util.h:161</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a85576980e059ee1471fe6ae2ae8f1b59"><div class="ttname"><a href="class_c_tx_d_b.html#a85576980e059ee1471fe6ae2ae8f1b59">CTxDB::ReadSyncCheckpoint</a></div><div class="ttdeci">bool ReadSyncCheckpoint(uint256 &amp;hashCheckpoint)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00336">txdb-leveldb.cpp:336</a></div></div>
<div class="ttc" id="structleveldb_1_1_options_html_a4e87749ebac1ba28dff6bb63eb2059e5"><div class="ttname"><a href="structleveldb_1_1_options.html#a4e87749ebac1ba28dff6bb63eb2059e5">leveldb::Options::block_cache</a></div><div class="ttdeci">Cache * block_cache</div><div class="ttdef"><b>Definition:</b> <a href="options_8h_source.html#l00098">options.h:98</a></div></div>
<div class="ttc" id="class_c_tx_index_html"><div class="ttname"><a href="class_c_tx_index.html">CTxIndex</a></div><div class="ttdoc">A txdb record that contains the disk location of a transaction and the locations of transactions that...</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00763">main.h:763</a></div></div>
<div class="ttc" id="class_c_block_index_html_a309fdc44d871b336abe64eadf250cafd"><div class="ttname"><a href="class_c_block_index.html#a309fdc44d871b336abe64eadf250cafd">CBlockIndex::nMoneySupply</a></div><div class="ttdeci">int64_t nMoneySupply</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01120">main.h:1120</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_ab417d5e3a281ae192658dcac6f4a39a9"><div class="ttname"><a href="class_c_tx_d_b.html#ab417d5e3a281ae192658dcac6f4a39a9">CTxDB::WriteCheckpointPubKey</a></div><div class="ttdeci">bool WriteCheckpointPubKey(const std::string &amp;strPubKey)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00351">txdb-leveldb.cpp:351</a></div></div>
<div class="ttc" id="version__set_8cc_html_a38c8b88c432e666ad10b0c5573e1160a"><div class="ttname"><a href="version__set_8cc.html#a38c8b88c432e666ad10b0c5573e1160a">value</a></div><div class="ttdeci">std::string * value</div><div class="ttdef"><b>Definition:</b> <a href="version__set_8cc_source.html#l00256">version_set.cc:256</a></div></div>
<div class="ttc" id="class_c_block_index_html_a1ef11137155df1dd5c81491630cece39"><div class="ttname"><a href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">CBlockIndex::pprev</a></div><div class="ttdeci">CBlockIndex * pprev</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01112">main.h:1112</a></div></div>
<div class="ttc" id="serialize_8h_html_aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d"><div class="ttname"><a href="serialize_8h.html#aaf105ae5beaca1dee30ae54530691fcea34949680c53028d35a449bf88b3c329d">SER_DISK</a></div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00049">serialize.h:49</a></div></div>
<div class="ttc" id="namespaceboost_html"><div class="ttname"><a href="namespaceboost.html">boost</a></div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00017">util.cpp:17</a></div></div>
<div class="ttc" id="txdb-leveldb_8cpp_html_a72eff8ae1d84de13daf97a61b8c02bc6"><div class="ttname"><a href="txdb-leveldb_8cpp.html#a72eff8ae1d84de13daf97a61b8c02bc6">txdb</a></div><div class="ttdeci">leveldb::DB * txdb</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00026">txdb-leveldb.cpp:26</a></div></div>
<div class="ttc" id="class_c_block_html_a77a1b1e9902e1e557d762f5a5f325cd8"><div class="ttname"><a href="class_c_block.html#a77a1b1e9902e1e557d762f5a5f325cd8">CBlock::ReadFromDisk</a></div><div class="ttdeci">bool ReadFromDisk(unsigned int nFile, unsigned int nBlockPos, bool fReadTransactions=true)</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01031">main.h:1031</a></div></div>
<div class="ttc" id="memenv_8h_html"><div class="ttname"><a href="memenv_8h.html">memenv.h</a></div></div>
<div class="ttc" id="class_c_big_num_html_ad17ff84ee557ca5ad4b854e14d08099f"><div class="ttname"><a href="class_c_big_num.html#ad17ff84ee557ca5ad4b854e14d08099f">CBigNum::getuint256</a></div><div class="ttdeci">uint256 getuint256() const </div><div class="ttdef"><b>Definition:</b> <a href="bignum_8h_source.html#l00278">bignum.h:278</a></div></div>
<div class="ttc" id="class_c_block_html"><div class="ttname"><a href="class_c_block.html">CBlock</a></div><div class="ttdoc">Nodes collect new transactions into a block, hash them into a hash tree, and scan through nonce value...</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00827">main.h:827</a></div></div>
<div class="ttc" id="util_8h_html_aa3052ab82a2ba880ea3e30b3357c8820"><div class="ttname"><a href="util_8h.html#aa3052ab82a2ba880ea3e30b3357c8820">PAIRTYPE</a></div><div class="ttdeci">#define PAIRTYPE(t1, t2)</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00073">util.h:73</a></div></div>
<div class="ttc" id="classleveldb_1_1_slice_html_aa64861043d9deee6889461bf0593cf73"><div class="ttname"><a href="classleveldb_1_1_slice.html#aa64861043d9deee6889461bf0593cf73">leveldb::Slice::data</a></div><div class="ttdeci">const char * data() const </div><div class="ttdef"><b>Definition:</b> <a href="slice_8h_source.html#l00040">slice.h:40</a></div></div>
<div class="ttc" id="main_8cpp_html_a76784ec097b3e97b81272c0858d623e4"><div class="ttname"><a href="main_8cpp.html#a76784ec097b3e97b81272c0858d623e4">setStakeSeen</a></div><div class="ttdeci">set&lt; pair&lt; COutPoint, unsigned int &gt; &gt; setStakeSeen</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00039">main.cpp:39</a></div></div>
<div class="ttc" id="kernel_8h_html"><div class="ttname"><a href="kernel_8h.html">kernel.h</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a56f170187a609bd747c29b3a4adddd8e"><div class="ttname"><a href="class_c_tx_d_b.html#a56f170187a609bd747c29b3a4adddd8e">CTxDB::WriteBlockIndex</a></div><div class="ttdeci">bool WriteBlockIndex(const CDiskBlockIndex &amp;blockindex)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00311">txdb-leveldb.cpp:311</a></div></div>
<div class="ttc" id="util_8cpp_html_a5dda805bdc19ceffaf26ddd2056ccc0a"><div class="ttname"><a href="util_8cpp.html#a5dda805bdc19ceffaf26ddd2056ccc0a">fRequestShutdown</a></div><div class="ttdeci">bool fRequestShutdown</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00066">util.cpp:66</a></div></div>
<div class="ttc" id="classleveldb_1_1_write_batch_html"><div class="ttname"><a href="classleveldb_1_1_write_batch.html">leveldb::WriteBatch</a></div><div class="ttdef"><b>Definition:</b> <a href="write__batch_8h_source.html#l00031">write_batch.h:31</a></div></div>
<div class="ttc" id="class_c_block_index_html_a3bf9ecd8938c42be6a4b14d3c7ef5c21"><div class="ttname"><a href="class_c_block_index.html#a3bf9ecd8938c42be6a4b14d3c7ef5c21">CBlockIndex::nFile</a></div><div class="ttdeci">unsigned int nFile</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01114">main.h:1114</a></div></div>
<div class="ttc" id="classleveldb_1_1_status_html"><div class="ttname"><a href="classleveldb_1_1_status.html">leveldb::Status</a></div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00021">status.h:21</a></div></div>
<div class="ttc" id="class_c_disk_tx_pos_html"><div class="ttname"><a href="class_c_disk_tx_pos.html">CDiskTxPos</a></div><div class="ttdoc">Position on disk for a particular transaction. </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00151">main.h:151</a></div></div>
<div class="ttc" id="class_c_transaction_html_a3f8666d2a275c40da14bd5eaf47dc004"><div class="ttname"><a href="class_c_transaction.html#a3f8666d2a275c40da14bd5eaf47dc004">CTransaction::GetHash</a></div><div class="ttdeci">uint256 GetHash() const </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00483">main.h:483</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a6c0d7c688e8fd7ac28afde78ae6b624e"><div class="ttname"><a href="class_c_tx_d_b.html#a6c0d7c688e8fd7ac28afde78ae6b624e">CTxDB::AddTxIndex</a></div><div class="ttdeci">bool AddTxIndex(const CTransaction &amp;tx, const CDiskTxPos &amp;pos, int nHeight)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00210">txdb-leveldb.cpp:210</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a8a138e5dcc3ef98991abaa16eaa8ddeb"><div class="ttname"><a href="class_c_tx_d_b.html#a8a138e5dcc3ef98991abaa16eaa8ddeb">CTxDB::ReadTxIndex</a></div><div class="ttdeci">bool ReadTxIndex(uint256 hash, CTxIndex &amp;txindex)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00199">txdb-leveldb.cpp:199</a></div></div>
<div class="ttc" id="class_c_block_index_html_a02aaba7d27ec615e6f9f740353d839de"><div class="ttname"><a href="class_c_block_index.html#a02aaba7d27ec615e6f9f740353d839de">CBlockIndex::nFlags</a></div><div class="ttdeci">unsigned int nFlags</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01122">main.h:1122</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div></div>
<div class="ttc" id="kernel_8cpp_html_abe84e84f5454fc09dca2044396daf59d"><div class="ttname"><a href="kernel_8cpp.html#abe84e84f5454fc09dca2044396daf59d">GetStakeModifierChecksum</a></div><div class="ttdeci">unsigned int GetStakeModifierChecksum(const CBlockIndex *pindex)</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8cpp_source.html#l00457">kernel.cpp:457</a></div></div>
<div class="ttc" id="structleveldb_1_1_write_options_html"><div class="ttname"><a href="structleveldb_1_1_write_options.html">leveldb::WriteOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="options_8h_source.html#l00169">options.h:169</a></div></div>
<div class="ttc" id="classleveldb_1_1_write_batch_1_1_handler_html"><div class="ttname"><a href="classleveldb_1_1_write_batch_1_1_handler.html">leveldb::WriteBatch::Handler</a></div><div class="ttdef"><b>Definition:</b> <a href="write__batch_8h_source.html#l00046">write_batch.h:46</a></div></div>
<div class="ttc" id="class_c_data_stream_html"><div class="ttname"><a href="class_c_data_stream.html">CDataStream</a></div><div class="ttdoc">Double ended buffer combining vector and stream-like interfaces. </div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00744">serialize.h:744</a></div></div>
<div class="ttc" id="class_c_transaction_html_ad004cb6fdc2c42ca9e1fabf05a7d0ab3"><div class="ttname"><a href="class_c_transaction.html#ad004cb6fdc2c42ca9e1fabf05a7d0ab3">CTransaction::CheckTransaction</a></div><div class="ttdeci">bool CheckTransaction() const </div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00638">main.cpp:638</a></div></div>
<div class="ttc" id="class_c_tx_index_html_a88317d56c02acd1faec4863bcb293d2c"><div class="ttname"><a href="class_c_tx_index.html#a88317d56c02acd1faec4863bcb293d2c">CTxIndex::vSpent</a></div><div class="ttdeci">std::vector&lt; CDiskTxPos &gt; vSpent</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00767">main.h:767</a></div></div>
<div class="ttc" id="class_c_out_point_html_a9fbc648ca0d11421ad66e897185a9b58"><div class="ttname"><a href="class_c_out_point.html#a9fbc648ca0d11421ad66e897185a9b58">COutPoint::n</a></div><div class="ttdeci">unsigned int n</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00223">main.h:223</a></div></div>
<div class="ttc" id="env_8h_html"><div class="ttname"><a href="env_8h.html">env.h</a></div></div>
<div class="ttc" id="class_c_block_index_html_a2aa226c04d79a4d932ed6eb0abd02cbe"><div class="ttname"><a href="class_c_block_index.html#a2aa226c04d79a4d932ed6eb0abd02cbe">CBlockIndex::nStakeModifier</a></div><div class="ttdeci">uint64_t nStakeModifier</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01130">main.h:1130</a></div></div>
<div class="ttc" id="classleveldb_1_1_slice_html"><div class="ttname"><a href="classleveldb_1_1_slice.html">leveldb::Slice</a></div><div class="ttdef"><b>Definition:</b> <a href="slice_8h_source.html#l00025">slice.h:25</a></div></div>
<div class="ttc" id="class_c_block_index_html_aa11268e5a01c5a7d33fb313fb0494015"><div class="ttname"><a href="class_c_block_index.html#aa11268e5a01c5a7d33fb313fb0494015">CBlockIndex::nChainTrust</a></div><div class="ttdeci">uint256 nChainTrust</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01116">main.h:1116</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_ad319e9c15a7a03b9b80d7affb7fb655e"><div class="ttname"><a href="class_c_tx_d_b.html#ad319e9c15a7a03b9b80d7affb7fb655e">CTxDB::Close</a></div><div class="ttdeci">void Close()</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00123">txdb-leveldb.cpp:123</a></div></div>
<div class="ttc" id="class_c_block_index_html_a32c6c256b6e30b4a20dc6faa9cac7ea5"><div class="ttname"><a href="class_c_block_index.html#a32c6c256b6e30b4a20dc6faa9cac7ea5">CBlockIndex::CheckIndex</a></div><div class="ttdeci">bool CheckIndex() const </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01235">main.h:1235</a></div></div>
<div class="ttc" id="classleveldb_1_1_iterator_html_a613ac2e965518aad7a064c64c72bcf7c"><div class="ttname"><a href="classleveldb_1_1_iterator.html#a613ac2e965518aad7a064c64c72bcf7c">leveldb::Iterator::value</a></div><div class="ttdeci">virtual Slice value() const =0</div></div>
<div class="ttc" id="class_c_tx_d_b_html_ab0e2e8f95c4f891c0a9245d5ba6b0b68"><div class="ttname"><a href="class_c_tx_d_b.html#ab0e2e8f95c4f891c0a9245d5ba6b0b68">CTxDB::ReadBestInvalidTrust</a></div><div class="ttdeci">bool ReadBestInvalidTrust(CBigNum &amp;bnBestInvalidTrust)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00326">txdb-leveldb.cpp:326</a></div></div>
<div class="ttc" id="classleveldb_1_1_iterator_html_aea54a5ca7eb942eb15770820529410e7"><div class="ttname"><a href="classleveldb_1_1_iterator.html#aea54a5ca7eb942eb15770820529410e7">leveldb::Iterator::Next</a></div><div class="ttdeci">virtual void Next()=0</div></div>
<div class="ttc" id="main_8h_html"><div class="ttname"><a href="main_8h.html">main.h</a></div></div>
<div class="ttc" id="class_c_transaction_html_ad9d526afecbd816c385343f60c5352fd"><div class="ttname"><a href="class_c_transaction.html#ad9d526afecbd816c385343f60c5352fd">CTransaction::ReadFromDisk</a></div><div class="ttdeci">bool ReadFromDisk(CDiskTxPos pos, FILE **pfileRet=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00581">main.h:581</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a15efd656b7f86b0abf8d99183cae493a"><div class="ttname"><a href="class_c_tx_d_b.html#a15efd656b7f86b0abf8d99183cae493a">CTxDB::CTxDB</a></div><div class="ttdeci">CTxDB(const char *pszMode=&quot;r+&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00068">txdb-leveldb.cpp:68</a></div></div>
<div class="ttc" id="main_8cpp_html_a63af124faf22e03fd629e8aa21c40eae"><div class="ttname"><a href="main_8cpp.html#a63af124faf22e03fd629e8aa21c40eae">nBestChainTrust</a></div><div class="ttdeci">uint256 nBestChainTrust</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00055">main.cpp:55</a></div></div>
<div class="ttc" id="classleveldb_1_1_d_b_html"><div class="ttname"><a href="classleveldb_1_1_d_b.html">leveldb::DB</a></div><div class="ttdef"><b>Definition:</b> <a href="leveldb_2include_2leveldb_2db_8h_source.html#l00044">db.h:44</a></div></div>
<div class="ttc" id="class_c_data_stream_html_aa3a9ecf166f36f4ea531d2b23628d2c9"><div class="ttname"><a href="class_c_data_stream.html#aa3a9ecf166f36f4ea531d2b23628d2c9">CDataStream::str</a></div><div class="ttdeci">std::string str() const </div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00820">serialize.h:820</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a62fb371022854dc8cb247bed36302df2"><div class="ttname"><a href="class_c_tx_d_b.html#a62fb371022854dc8cb247bed36302df2">CTxDB::UpdateTxIndex</a></div><div class="ttdeci">bool UpdateTxIndex(uint256 hash, const CTxIndex &amp;txindex)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00205">txdb-leveldb.cpp:205</a></div></div>
<div class="ttc" id="class_c_batch_scanner_html_ad2669c1d3fbd8c206b1f42348dde8cf0"><div class="ttname"><a href="class_c_batch_scanner.html#ad2669c1d3fbd8c206b1f42348dde8cf0">CBatchScanner::foundEntry</a></div><div class="ttdeci">bool foundEntry</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00160">txdb-leveldb.cpp:160</a></div></div>
<div class="ttc" id="class_c_block_index_html_ad29fd7c96d1e350aa39c61a2afcfdb26"><div class="ttname"><a href="class_c_block_index.html#ad29fd7c96d1e350aa39c61a2afcfdb26">CBlockIndex::nStakeModifierChecksum</a></div><div class="ttdeci">unsigned int nStakeModifierChecksum</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01131">main.h:1131</a></div></div>
<div class="ttc" id="class_c_block_index_html_a4b687a226e9e166b0f91c1b616b543a6"><div class="ttname"><a href="class_c_block_index.html#a4b687a226e9e166b0f91c1b616b543a6">CBlockIndex::nTime</a></div><div class="ttdeci">unsigned int nTime</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01142">main.h:1142</a></div></div>
<div class="ttc" id="structleveldb_1_1_options_html"><div class="ttname"><a href="structleveldb_1_1_options.html">leveldb::Options</a></div><div class="ttdef"><b>Definition:</b> <a href="options_8h_source.html#l00031">options.h:31</a></div></div>
<div class="ttc" id="protocol_8h_html_add584db8359330a002dc0d5c4decdb07"><div class="ttname"><a href="protocol_8h.html#add584db8359330a002dc0d5c4decdb07">fTestNet</a></div><div class="ttdeci">bool fTestNet</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00072">util.cpp:72</a></div></div>
<div class="ttc" id="namespace_checkpoints_html_ae6bf7381439fe6995194c0b636bd6f37"><div class="ttname"><a href="namespace_checkpoints.html#ae6bf7381439fe6995194c0b636bd6f37">Checkpoints::hashSyncCheckpoint</a></div><div class="ttdeci">uint256 hashSyncCheckpoint</div><div class="ttdef"><b>Definition:</b> <a href="checkpoints_8cpp_source.html#l00076">checkpoints.cpp:76</a></div></div>
<div class="ttc" id="class_c_batch_scanner_html_a3a82f2f7068f469eb535435a0b9ae640"><div class="ttname"><a href="class_c_batch_scanner.html#a3a82f2f7068f469eb535435a0b9ae640">CBatchScanner::foundValue</a></div><div class="ttdeci">std::string * foundValue</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00159">txdb-leveldb.cpp:159</a></div></div>
<div class="ttc" id="filter__policy_8h_html"><div class="ttname"><a href="filter__policy_8h.html">filter_policy.h</a></div></div>
<div class="ttc" id="checkpoints_8h_html"><div class="ttname"><a href="checkpoints_8h.html">checkpoints.h</a></div></div>
<div class="ttc" id="class_c_tx_in_html"><div class="ttname"><a href="class_c_tx_in.html">CTxIn</a></div><div class="ttdoc">An input of a transaction. </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00264">main.h:264</a></div></div>
<div class="ttc" id="class_c_block_index_html_ac2c040d5e3db73a5ceb87ee4095a405f"><div class="ttname"><a href="class_c_block_index.html#ac2c040d5e3db73a5ceb87ee4095a405f">CBlockIndex::prevoutStake</a></div><div class="ttdeci">COutPoint prevoutStake</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01134">main.h:1134</a></div></div>
<div class="ttc" id="class_c_disk_tx_pos_html_ae9b3c262149c035be43010cbf7d1423b"><div class="ttname"><a href="class_c_disk_tx_pos.html#ae9b3c262149c035be43010cbf7d1423b">CDiskTxPos::nBlockPos</a></div><div class="ttdeci">unsigned int nBlockPos</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00155">main.h:155</a></div></div>
<div class="ttc" id="class_c_transaction_html_ae42c0032a464c3054c508017c7d040ef"><div class="ttname"><a href="class_c_transaction.html#ae42c0032a464c3054c508017c7d040ef">CTransaction::vout</a></div><div class="ttdeci">std::vector&lt; CTxOut &gt; vout</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00446">main.h:446</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a09b87317101ed16b6ad99794279f4c2d"><div class="ttname"><a href="class_c_tx_d_b.html#a09b87317101ed16b6ad99794279f4c2d">CTxDB::ContainsTx</a></div><div class="ttdeci">bool ContainsTx(uint256 hash)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00225">txdb-leveldb.cpp:225</a></div></div>
<div class="ttc" id="classleveldb_1_1_slice_html_a947d3173f04f8a30553e89046daf91d5"><div class="ttname"><a href="classleveldb_1_1_slice.html#a947d3173f04f8a30553e89046daf91d5">leveldb::Slice::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdef"><b>Definition:</b> <a href="slice_8h_source.html#l00043">slice.h:43</a></div></div>
<div class="ttc" id="classleveldb_1_1_d_b_html_ac1da2b48e911287d86f3a3bfa0f851fe"><div class="ttname"><a href="classleveldb_1_1_d_b.html#ac1da2b48e911287d86f3a3bfa0f851fe">leveldb::DB::Open</a></div><div class="ttdeci">static Status Open(const Options &amp;options, const std::string &amp;name, DB **dbptr)</div><div class="ttdef"><b>Definition:</b> <a href="db__impl_8cc_source.html#l01445">db_impl.cc:1445</a></div></div>
<div class="ttc" id="txdb-leveldb_8cpp_html_a9a8c309c31bb9f6feadef44982002926"><div class="ttname"><a href="txdb-leveldb_8cpp.html#a9a8c309c31bb9f6feadef44982002926">init_blockindex</a></div><div class="ttdeci">void init_blockindex(leveldb::Options &amp;options, bool fRemoveOld=false)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00036">txdb-leveldb.cpp:36</a></div></div>
<div class="ttc" id="class_c_transaction_html_a53fa787e4ea57374b4fa2a28e9a957b2"><div class="ttname"><a href="class_c_transaction.html#a53fa787e4ea57374b4fa2a28e9a957b2">CTransaction::vin</a></div><div class="ttdeci">std::vector&lt; CTxIn &gt; vin</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00445">main.h:445</a></div></div>
<div class="ttc" id="bitcoinrpc_8cpp_html_a3cb9f0894fab1c8fbb0753c9c7c2a8d9"><div class="ttname"><a href="bitcoinrpc_8cpp.html#a3cb9f0894fab1c8fbb0753c9c7c2a8d9">printf</a></div><div class="ttdeci">#define printf</div><div class="ttdef"><b>Definition:</b> <a href="bitcoinrpc_8cpp_source.html#l00028">bitcoinrpc.cpp:28</a></div></div>
<div class="ttc" id="cache_8h_html"><div class="ttname"><a href="cache_8h.html">cache.h</a></div></div>
<div class="ttc" id="class_c_big_num_html"><div class="ttname"><a href="class_c_big_num.html">CBigNum</a></div><div class="ttdoc">C++ wrapper for BIGNUM (OpenSSL bignum) </div><div class="ttdef"><b>Definition:</b> <a href="bignum_8h_source.html#l00057">bignum.h:57</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a8c718f82f43d567b5bf7487b5d6685e5"><div class="ttname"><a href="class_c_tx_d_b.html#a8c718f82f43d567b5bf7487b5d6685e5">CTxDB::ScanBatch</a></div><div class="ttdeci">bool ScanBatch(const CDataStream &amp;key, std::string *value, bool *deleted) const </div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00185">txdb-leveldb.cpp:185</a></div></div>
<div class="ttc" id="class_c_block_index_html_a3324894e6af612d1bd76f89378435713"><div class="ttname"><a href="class_c_block_index.html#a3324894e6af612d1bd76f89378435713">CBlockIndex::nBits</a></div><div class="ttdeci">unsigned int nBits</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01143">main.h:1143</a></div></div>
<div class="ttc" id="classleveldb_1_1_iterator_html_a97a556e97ded60c677fbf4de7321ec44"><div class="ttname"><a href="classleveldb_1_1_iterator.html#a97a556e97ded60c677fbf4de7321ec44">leveldb::Iterator::Seek</a></div><div class="ttdeci">virtual void Seek(const Slice &amp;target)=0</div></div>
<div class="ttc" id="class_c_block_index_html_a0601b6b2bd6eaedfbc283c00d045a21c"><div class="ttname"><a href="class_c_block_index.html#a0601b6b2bd6eaedfbc283c00d045a21c">CBlockIndex::hashMerkleRoot</a></div><div class="ttdeci">uint256 hashMerkleRoot</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01141">main.h:1141</a></div></div>
<div class="ttc" id="namespaceleveldb_html_ae6b34bf2331983721554f284b1eaa1a1"><div class="ttname"><a href="namespaceleveldb.html#ae6b34bf2331983721554f284b1eaa1a1">leveldb::NewBloomFilterPolicy</a></div><div class="ttdeci">const FilterPolicy * NewBloomFilterPolicy(int bits_per_key)</div><div class="ttdef"><b>Definition:</b> <a href="bloom_8cc_source.html#l00091">bloom.cc:91</a></div></div>
<div class="ttc" id="util_8h_html"><div class="ttname"><a href="util_8h.html">util.h</a></div></div>
<div class="ttc" id="class_c_disk_block_index_html"><div class="ttname"><a href="class_c_disk_block_index.html">CDiskBlockIndex</a></div><div class="ttdoc">Used to marshal pointers into hashes for db storage. </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01334">main.h:1334</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_af3c27c5cb8f922b5c03840feda844016"><div class="ttname"><a href="class_c_tx_d_b.html#af3c27c5cb8f922b5c03840feda844016">CTxDB::TxnBegin</a></div><div class="ttdeci">bool TxnBegin()</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00135">txdb-leveldb.cpp:135</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a5e0f0ed39529758a90953a2a08fc9412"><div class="ttname"><a href="class_c_tx_d_b.html#a5e0f0ed39529758a90953a2a08fc9412">CTxDB::EraseTxIndex</a></div><div class="ttdeci">bool EraseTxIndex(const CTransaction &amp;tx)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00218">txdb-leveldb.cpp:218</a></div></div>
<div class="ttc" id="txdb_8h_html"><div class="ttname"><a href="txdb_8h.html">txdb.h</a></div></div>
<div class="ttc" id="class_c_out_point_html"><div class="ttname"><a href="class_c_out_point.html">COutPoint</a></div><div class="ttdoc">An outpoint - a combination of a transaction hash and an index n into its vout. </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00219">main.h:219</a></div></div>
<div class="ttc" id="class_c_block_html_a6e308b2d75d1cfc4a75eda36feb60ca1"><div class="ttname"><a href="class_c_block.html#a6e308b2d75d1cfc4a75eda36feb60ca1">CBlock::SetBestChain</a></div><div class="ttdeci">bool SetBestChain(CTxDB &amp;txdb, CBlockIndex *pindexNew)</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l01902">main.cpp:1902</a></div></div>
<div class="ttc" id="class_c_block_index_html_ab8cb2abace4e5b6dd405e85f66f17f9a"><div class="ttname"><a href="class_c_block_index.html#ab8cb2abace4e5b6dd405e85f66f17f9a">CBlockIndex::GetBlockTrust</a></div><div class="ttdeci">uint256 GetBlockTrust() const </div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l02353">main.cpp:2353</a></div></div>
<div class="ttc" id="class_c_batch_scanner_html_ae993b8af4417559238d9d985975f9f09"><div class="ttname"><a href="class_c_batch_scanner.html#ae993b8af4417559238d9d985975f9f09">CBatchScanner::Put</a></div><div class="ttdeci">virtual void Put(const leveldb::Slice &amp;key, const leveldb::Slice &amp;value)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00164">txdb-leveldb.cpp:164</a></div></div>
<div class="ttc" id="class_c_disk_tx_pos_html_a07198e7b96d4c60ece4d895abbd46104"><div class="ttname"><a href="class_c_disk_tx_pos.html#a07198e7b96d4c60ece4d895abbd46104">CDiskTxPos::nFile</a></div><div class="ttdeci">unsigned int nFile</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00154">main.h:154</a></div></div>
<div class="ttc" id="class_c_block_index_html_a45126301a0a6e26010527a7bbfc1ef58"><div class="ttname"><a href="class_c_block_index.html#a45126301a0a6e26010527a7bbfc1ef58">CBlockIndex::nVersion</a></div><div class="ttdeci">int nVersion</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01140">main.h:1140</a></div></div>
<div class="ttc" id="structleveldb_1_1_options_html_a24c88997a866d535e68de15b5c3cd02b"><div class="ttname"><a href="structleveldb_1_1_options.html#a24c88997a866d535e68de15b5c3cd02b">leveldb::Options::filter_policy</a></div><div class="ttdeci">const FilterPolicy * filter_policy</div><div class="ttdef"><b>Definition:</b> <a href="options_8h_source.html#l00136">options.h:136</a></div></div>
<div class="ttc" id="namespaceleveldb_html_a231e1b41322a8b342c91a15a78e425d4"><div class="ttname"><a href="namespaceleveldb.html#a231e1b41322a8b342c91a15a78e425d4">leveldb::NewLRUCache</a></div><div class="ttdeci">Cache * NewLRUCache(size_t capacity)</div><div class="ttdef"><b>Definition:</b> <a href="cache_8cc_source.html#l00321">cache.cc:321</a></div></div>
<div class="ttc" id="classuint256_html"><div class="ttname"><a href="classuint256.html">uint256</a></div><div class="ttdoc">256-bit unsigned integer </div><div class="ttdef"><b>Definition:</b> <a href="uint256_8h_source.html#l00517">uint256.h:517</a></div></div>
<div class="ttc" id="main_8cpp_html_a1e7c54b8b26730f52b5527163fc33d8f"><div class="ttname"><a href="main_8cpp.html#a1e7c54b8b26730f52b5527163fc33d8f">pindexGenesisBlock</a></div><div class="ttdeci">CBlockIndex * pindexGenesisBlock</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00052">main.cpp:52</a></div></div>
<div class="ttc" id="main_8cpp_html_ace9c3343567f488a96598abe61e1d309"><div class="ttname"><a href="main_8cpp.html#ace9c3343567f488a96598abe61e1d309">hashBestChain</a></div><div class="ttdeci">uint256 hashBestChain</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00058">main.cpp:58</a></div></div>
<div class="ttc" id="class_c_block_index_html_a2f0acd342accaab731d887584b444590"><div class="ttname"><a href="class_c_block_index.html#a2f0acd342accaab731d887584b444590">CBlockIndex::pnext</a></div><div class="ttdeci">CBlockIndex * pnext</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01113">main.h:1113</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a2cf58de69c1c07e500a1f8d0b0709476"><div class="ttname"><a href="class_c_tx_d_b.html#a2cf58de69c1c07e500a1f8d0b0709476">CTxDB::WriteHashBestChain</a></div><div class="ttdeci">bool WriteHashBestChain(uint256 hashBestChain)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00321">txdb-leveldb.cpp:321</a></div></div>
<div class="ttc" id="class_c_block_index_html_af8de5426e2da2c78e1e7729a89a7670a"><div class="ttname"><a href="class_c_block_index.html#af8de5426e2da2c78e1e7729a89a7670a">CBlockIndex::nBlockPos</a></div><div class="ttdeci">unsigned int nBlockPos</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01115">main.h:1115</a></div></div>
<div class="ttc" id="class_c_data_stream_html_a878b5fa69636a1f092d0b877dfdd31fc"><div class="ttname"><a href="class_c_data_stream.html#a878b5fa69636a1f092d0b877dfdd31fc">CDataStream::write</a></div><div class="ttdeci">CDataStream &amp; write(const char *pch, int nSize)</div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00990">serialize.h:990</a></div></div>
<div class="ttc" id="class_c_block_index_html_a553e6fc301e8130118d7ec68dce91ee9"><div class="ttname"><a href="class_c_block_index.html#a553e6fc301e8130118d7ec68dce91ee9">CBlockIndex::hashProof</a></div><div class="ttdeci">uint256 hashProof</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01137">main.h:1137</a></div></div>
<div class="ttc" id="classleveldb_1_1_iterator_html"><div class="ttname"><a href="classleveldb_1_1_iterator.html">leveldb::Iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="iterator_8h_source.html#l00023">iterator.h:23</a></div></div>
<div class="ttc" id="class_c_block_index_html"><div class="ttname"><a href="class_c_block_index.html">CBlockIndex</a></div><div class="ttdoc">The block chain is a tree shaped structure starting with the genesis block at the root...</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01108">main.h:1108</a></div></div>
<div class="ttc" id="class_c_batch_scanner_html_ae04f7151c91676f9f6209737cdc3d086"><div class="ttname"><a href="class_c_batch_scanner.html#ae04f7151c91676f9f6209737cdc3d086">CBatchScanner::needle</a></div><div class="ttdeci">std::string needle</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00157">txdb-leveldb.cpp:157</a></div></div>
<div class="ttc" id="kernel_8cpp_html_ace6da0cc4405eedd50d7a15d9f3e4f74"><div class="ttname"><a href="kernel_8cpp.html#ace6da0cc4405eedd50d7a15d9f3e4f74">CheckStakeModifierCheckpoints</a></div><div class="ttdeci">bool CheckStakeModifierCheckpoints(int nHeight, unsigned int nStakeModifierChecksum)</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8cpp_source.html#l00471">kernel.cpp:471</a></div></div>
<div class="ttc" id="classbase__uint_html_ac3080a72402cadf28dbc9f9b69cc60be"><div class="ttname"><a href="classbase__uint.html#ac3080a72402cadf28dbc9f9b69cc60be">base_uint::ToString</a></div><div class="ttdeci">std::string ToString() const </div><div class="ttdef"><b>Definition:</b> <a href="uint256_8h_source.html#l00339">uint256.h:339</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a32d0e546eee99724776352dd4bf0ae79"><div class="ttname"><a href="class_c_tx_d_b.html#a32d0e546eee99724776352dd4bf0ae79">CTxDB::ReadDiskTx</a></div><div class="ttdeci">bool ReadDiskTx(uint256 hash, CTransaction &amp;tx, CTxIndex &amp;txindex)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00261">txdb-leveldb.cpp:261</a></div></div>
<div class="ttc" id="classleveldb_1_1_iterator_html_a38614978bfa0586327b8e237bcb46012"><div class="ttname"><a href="classleveldb_1_1_iterator.html#a38614978bfa0586327b8e237bcb46012">leveldb::Iterator::Valid</a></div><div class="ttdeci">virtual bool Valid() const =0</div></div>
<div class="ttc" id="class_c_tx_index_html_ac68a69ed4335b3f50b954c71ec0a9c32"><div class="ttname"><a href="class_c_tx_index.html#ac68a69ed4335b3f50b954c71ec0a9c32">CTxIndex::pos</a></div><div class="ttdeci">CDiskTxPos pos</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00766">main.h:766</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html"><div class="ttname"><a href="class_c_tx_d_b.html">CTxDB</a></div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8h_source.html#l00030">txdb-leveldb.h:30</a></div></div>
<div class="ttc" id="classleveldb_1_1_iterator_html_ad17feced6e24a1b21db5ae6940c1f220"><div class="ttname"><a href="classleveldb_1_1_iterator.html#ad17feced6e24a1b21db5ae6940c1f220">leveldb::Iterator::key</a></div><div class="ttdeci">virtual Slice key() const =0</div></div>
<div class="ttc" id="main_8cpp_html_a6454ad864029344132a0a0b59b1456ee"><div class="ttname"><a href="main_8cpp.html#a6454ad864029344132a0a0b59b1456ee">pindexBest</a></div><div class="ttdeci">CBlockIndex * pindexBest</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00059">main.cpp:59</a></div></div>
<div class="ttc" id="classleveldb_1_1_status_html_ab31e89a858c766716e3dc952be857c65"><div class="ttname"><a href="classleveldb_1_1_status.html#ab31e89a858c766716e3dc952be857c65">leveldb::Status::ok</a></div><div class="ttdeci">bool ok() const </div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00052">status.h:52</a></div></div>
<div class="ttc" id="class_c_batch_scanner_html"><div class="ttname"><a href="class_c_batch_scanner.html">CBatchScanner</a></div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00155">txdb-leveldb.cpp:155</a></div></div>
<div class="ttc" id="class_c_block_html_a9b6508d662722775f3029b980b382b66"><div class="ttname"><a href="class_c_block.html#a9b6508d662722775f3029b980b382b66">CBlock::vtx</a></div><div class="ttdeci">std::vector&lt; CTransaction &gt; vtx</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00840">main.h:840</a></div></div>
<div class="ttc" id="util_8cpp_html_a24f685720bf40370e5bd2a192ad50cd8"><div class="ttname"><a href="util_8cpp.html#a24f685720bf40370e5bd2a192ad50cd8">GetArg</a></div><div class="ttdeci">std::string GetArg(const std::string &amp;strArg, const std::string &amp;strDefault)</div><div class="ttdoc">Return string argument or default value. </div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00548">util.cpp:548</a></div></div>
<div class="ttc" id="class_c_transaction_html"><div class="ttname"><a href="class_c_transaction.html">CTransaction</a></div><div class="ttdoc">The basic transaction that is broadcasted on the network and contained in blocks. ...</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00439">main.h:439</a></div></div>
<div class="ttc" id="class_c_block_index_html_aebfc8d6b95852546760e742553d7bfd5"><div class="ttname"><a href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">CBlockIndex::nHeight</a></div><div class="ttdeci">int nHeight</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01117">main.h:1117</a></div></div>
<div class="ttc" id="class_c_batch_scanner_html_a5569f5c1c04cbdaa1e226895d9cdb51a"><div class="ttname"><a href="class_c_batch_scanner.html#a5569f5c1c04cbdaa1e226895d9cdb51a">CBatchScanner::Delete</a></div><div class="ttdeci">virtual void Delete(const leveldb::Slice &amp;key)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00172">txdb-leveldb.cpp:172</a></div></div>
<div class="ttc" id="structleveldb_1_1_read_options_html"><div class="ttname"><a href="structleveldb_1_1_read_options.html">leveldb::ReadOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="options_8h_source.html#l00143">options.h:143</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a9aae38d6e39ce57a1b8eaaeaea81e4de"><div class="ttname"><a href="class_c_tx_d_b.html#a9aae38d6e39ce57a1b8eaaeaea81e4de">CTxDB::ReadHashBestChain</a></div><div class="ttdeci">bool ReadHashBestChain(uint256 &amp;hashBestChain)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00316">txdb-leveldb.cpp:316</a></div></div>
<div class="ttc" id="class_c_block_index_html_a6559fddea3401548ae144e870d150359"><div class="ttname"><a href="class_c_block_index.html#a6559fddea3401548ae144e870d150359">CBlockIndex::nMint</a></div><div class="ttdeci">int64_t nMint</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01119">main.h:1119</a></div></div>
<div class="ttc" id="main_8cpp_html_a843f1984796a7e44a9e23fccd6a8af34"><div class="ttname"><a href="main_8cpp.html#a843f1984796a7e44a9e23fccd6a8af34">nBestHeight</a></div><div class="ttdeci">int nBestHeight</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00053">main.cpp:53</a></div></div>
<div class="ttc" id="class_c_batch_scanner_html_adca0bf13e3c7eb3f70cf324da1901a4a"><div class="ttname"><a href="class_c_batch_scanner.html#adca0bf13e3c7eb3f70cf324da1901a4a">CBatchScanner::CBatchScanner</a></div><div class="ttdeci">CBatchScanner()</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00162">txdb-leveldb.cpp:162</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_a6fed172063f2ec1f4688ac3f21b0608a"><div class="ttname"><a href="class_c_tx_d_b.html#a6fed172063f2ec1f4688ac3f21b0608a">CTxDB::WriteSyncCheckpoint</a></div><div class="ttdeci">bool WriteSyncCheckpoint(uint256 hashCheckpoint)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00341">txdb-leveldb.cpp:341</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_abcb9df0821d996f811f6604b452a26a0"><div class="ttname"><a href="class_c_tx_d_b.html#abcb9df0821d996f811f6604b452a26a0">CTxDB::LoadBlockIndex</a></div><div class="ttdeci">bool LoadBlockIndex()</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00376">txdb-leveldb.cpp:376</a></div></div>
<div class="ttc" id="class_c_block_index_html_ab63b774ae798f5f9e54b400ac8b5ef4b"><div class="ttname"><a href="class_c_block_index.html#ab63b774ae798f5f9e54b400ac8b5ef4b">CBlockIndex::GetBlockTime</a></div><div class="ttdeci">int64_t GetBlockTime() const </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01223">main.h:1223</a></div></div>
<div class="ttc" id="classleveldb_1_1_slice_html_a2cdd9fb649105033fde510afc9416732"><div class="ttname"><a href="classleveldb_1_1_slice.html#a2cdd9fb649105033fde510afc9416732">leveldb::Slice::ToString</a></div><div class="ttdeci">std::string ToString() const </div><div class="ttdef"><b>Definition:</b> <a href="slice_8h_source.html#l00066">slice.h:66</a></div></div>
<div class="ttc" id="class_c_tx_in_html_aed9312051a25380cbd7f123408ab7c20"><div class="ttname"><a href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">CTxIn::prevout</a></div><div class="ttdeci">COutPoint prevout</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00267">main.h:267</a></div></div>
<div class="ttc" id="class_c_big_num_html_adca0fa61568497152375328deef6c895"><div class="ttname"><a href="class_c_big_num.html#adca0fa61568497152375328deef6c895">CBigNum::ToString</a></div><div class="ttdeci">std::string ToString(int nBase=10) const </div><div class="ttdef"><b>Definition:</b> <a href="bignum_8h_source.html#l00376">bignum.h:376</a></div></div>
<div class="ttc" id="util_8h_html_a749bc6776c8ec72d7c5e4dea56aee415"><div class="ttname"><a href="util_8h.html#a749bc6776c8ec72d7c5e4dea56aee415">DateTimeStrFormat</a></div><div class="ttdeci">std::string DateTimeStrFormat(const char *pszFormat, int64_t nTime)</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00335">util.h:335</a></div></div>
<div class="ttc" id="main_8cpp_html_a27c4c119ca2e7250221de8c17bee0999"><div class="ttname"><a href="main_8cpp.html#a27c4c119ca2e7250221de8c17bee0999">nBestInvalidTrust</a></div><div class="ttdeci">uint256 nBestInvalidTrust</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00056">main.cpp:56</a></div></div>
<div class="ttc" id="main_8cpp_html_a7ed5e264d5cdb0fdcf0fa6ae68ee4638"><div class="ttname"><a href="main_8cpp.html#a7ed5e264d5cdb0fdcf0fa6ae68ee4638">mapBlockIndex</a></div><div class="ttdeci">map&lt; uint256, CBlockIndex * &gt; mapBlockIndex</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00038">main.cpp:38</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_ab05fe91e649658eebe0a05227fde3059"><div class="ttname"><a href="class_c_tx_d_b.html#ab05fe91e649658eebe0a05227fde3059">CTxDB::ReadCheckpointPubKey</a></div><div class="ttdeci">bool ReadCheckpointPubKey(std::string &amp;strPubKey)</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00346">txdb-leveldb.cpp:346</a></div></div>
<div class="ttc" id="class_c_disk_tx_pos_html_ae4bdd4eba8a9712dba1b4216559f11df"><div class="ttname"><a href="class_c_disk_tx_pos.html#ae4bdd4eba8a9712dba1b4216559f11df">CDiskTxPos::IsNull</a></div><div class="ttdeci">bool IsNull() const </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00172">main.h:172</a></div></div>
<div class="ttc" id="cache_8cc_html_a11ecb029164e055f28f4123ce3748862"><div class="ttname"><a href="cache_8cc.html#a11ecb029164e055f28f4123ce3748862">hash</a></div><div class="ttdeci">uint32_t hash</div><div class="ttdef"><b>Definition:</b> <a href="cache_8cc_source.html#l00034">cache.cc:34</a></div></div>
<div class="ttc" id="class_c_block_index_html_a5e0a648ed1df8da171eba636d5ebef01"><div class="ttname"><a href="class_c_block_index.html#a5e0a648ed1df8da171eba636d5ebef01">CBlockIndex::nNonce</a></div><div class="ttdeci">unsigned int nNonce</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01144">main.h:1144</a></div></div>
<div class="ttc" id="class_c_block_index_html_ab843ef9b8b0a0193ec3a5c24738e484f"><div class="ttname"><a href="class_c_block_index.html#ab843ef9b8b0a0193ec3a5c24738e484f">CBlockIndex::GetBlockHash</a></div><div class="ttdeci">uint256 GetBlockHash() const </div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l01218">main.h:1218</a></div></div>
<div class="ttc" id="class_c_tx_d_b_html_aff04f078df2fc3640d559ce62fc9a6a2"><div class="ttname"><a href="class_c_tx_d_b.html#aff04f078df2fc3640d559ce62fc9a6a2">CTxDB::TxnCommit</a></div><div class="ttdeci">bool TxnCommit()</div><div class="ttdef"><b>Definition:</b> <a href="txdb-leveldb_8cpp_source.html#l00142">txdb-leveldb.cpp:142</a></div></div>
<div class="ttc" id="classleveldb_1_1_status_html_aa8b56d8fe2cd1873778de5d1e5407866"><div class="ttname"><a href="classleveldb_1_1_status.html#aa8b56d8fe2cd1873778de5d1e5407866">leveldb::Status::ToString</a></div><div class="ttdeci">std::string ToString() const </div><div class="ttdef"><b>Definition:</b> <a href="status_8cc_source.html#l00036">status.cc:36</a></div></div>
<div class="ttc" id="class_c_out_point_html_af131c7194a660558b0ff158f4efa7a28"><div class="ttname"><a href="class_c_out_point.html#af131c7194a660558b0ff158f4efa7a28">COutPoint::hash</a></div><div class="ttdeci">uint256 hash</div><div class="ttdef"><b>Definition:</b> <a href="main_8h_source.html#l00222">main.h:222</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 14 2015 11:20:03 for Bitcoin by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
